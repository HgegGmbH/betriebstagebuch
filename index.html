<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BETRIEBSTAGEBUCH</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap">

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="icon" href="https://i.imgur.com/jUXw3Nh.png" type="image/x-icon">
    <link rel="shortcut icon" href="https://i.imgur.com/jUXw3Nh.png" type="image/x-icon">

    <script>
        function e(name)
        {
            return document.getElementById(name);
        }

        function Show(element)
        {
            element.style.display = "block"
        }

        function Hide(element)
        {
            element.style.display = "none"
        }

        var DatabaseURL = "https://betriebstagebuch-1a1bb-default-rtdb.firebaseio.com/";

        const firebaseApp = firebase.initializeApp(
        { 
            apiKey: "AIzaSyAds2u73hfXzV1dDhs_hAOE-oT18bmvXB0",
            authDomain: "betriebstagebuch-1a1bb.firebaseapp.com",
            databaseURL: DatabaseURL,
            projectId: "betriebstagebuch-1a1bb",
            storageBucket: "betriebstagebuch-1a1bb.appspot.com",
            messagingSenderId: "388367667302",
            appId: "1:388367667302:web:41fd1b4b05150014325da7"
        });

        const db = firebaseApp.firestore();
        const auth = firebaseApp.auth();

        var database;
        var dataRef;

        var IstAngemeldet = false;

        function InitBetriebstagebuch(PasswortBenutzereingabe)
        {        
            var email = "kohlberg068897@gmail.com";

            auth.signInWithEmailAndPassword(email, PasswortBenutzereingabe)
            .then((userCredential) =>
            {
                console.log("Anmeldung erfolgreich:", userCredential.user.uid);
                document.getElementById("GesamteWebseite").style.display = "block";
                //console.log(GetVariable("data/var1"));

                database = firebase.database();
                dataRef = database.ref();

                IstAngemeldet = true;

                document.getElementById("AnmeldungFenster").style.display = "none";
                document.getElementById("GesamteWebseite").style.display = "block";
                document.getElementById("AnmeldungFehlgeschlagen").style.display = "none";

                setCookie("PasswortBetriebstagebuch", PasswortBenutzereingabe)

                Event_AnmeldungAbgeschlossen();
            })
            .catch((error) => 
            {
                IstAngemeldet = false;

                document.getElementById("AnmeldungFenster").style.display = "none";
                document.getElementById("GesamteWebseite").style.display = "none";
                document.getElementById("AnmeldungFehlgeschlagen").style.display = "block";
            });
        }

        function GetVariable(Pfad)
        {
            return new Promise((resolve, reject) =>
            {
                dataRef.child(Pfad).once("value")
                    .then((snapshot) =>
                    {
                        const variableninhalt = snapshot.val();
                        resolve(variableninhalt);
                        console.log(`LESEN: ${Pfad}`);
                    })
                    .catch((error) =>
                    {
                        console.log("Fehler beim Lesen der Daten:", error.message);
                        reject(error);
                    });
            });
        }

        function SetVariable(Pfad, neuerWert)
        {
            return new Promise((resolve, reject) =>
            {
                dataRef.child(Pfad).set(neuerWert)
                    .then(() =>
                    {
                        console.log(`Erfolgr.geschrieben '${Pfad}', '${neuerWert}'`);
                        resolve();
                    })
                    .catch((error) =>
                    {
                        console.log("Fehler beim Schreiben der Daten:", error.message);
                        reject(error);
                    });
            });
        }

        function GetSubvariablen(Pfad)
        {
            return new Promise((resolve, reject) => {
                dataRef.child(Pfad).once("value")
                    .then((snapshot) => {
                        const data = snapshot.val();
                        if (data && typeof data === "object") {
                            const subVariablesList = Object.keys(data).map(subVar => `${Pfad}/${subVar}`);
                            resolve(subVariablesList);
                        } else {
                            resolve([]);
                        }
                    })
                    .catch((error) => {
                        console.log("Fehler beim Lesen der Daten:", error.message);
                        reject(error);
                    });
            });
        }

        function formatDate(date)
        {
            if (!(date instanceof Date))
            {
                return "Ungültiges Datum";
            }

            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');

            const formattedDate = `${day}.${month}.${year}`;

            return formattedDate;
        }

        function getZeitstempel()
        {
            return new Date().getTime();
        }

        function getFileName(path)
        {
            const segments = path.split('/');
            return segments[segments.length - 1];
        }

        function setCookie(name, value)
        {
            var expirationDate = new Date();
            expirationDate.setDate(expirationDate.getDate() + 30);

            document.cookie = name + "=" + value + "; expires=" + expirationDate.toUTCString() + "; path=/";
        }

        function getCookie(name)
        {
            var cookieName = name + "=";
            var cookies = document.cookie.split(';');

            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.indexOf(cookieName) === 0) {
                    return cookie.substring(cookieName.length, cookie.length);
                }
            }

            return null;
        }

        function deleteCookie(name)
        {
            document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        }

        function cookieExists(name)
        {
            return getCookie(name) !== null;
        }
    </script>
</head>
<body style="background-color: rgb(36, 36, 36); color: rgb(218, 218, 218); ">
    
    <div class="container mt-5" id="AnmeldungFenster" style="display: none; text-align: center;"> 
        <strong style="font-size: 35pt; color: rgb(255, 255, 255);">Anmelden</strong><br><br>
        <label>Bitte das Passwort eingeben</label>
        <input type="password" class="form-control" id="PasswortTextBox" aria-describedby="basic-addon3" placeholder="Passwort eingeben"><br><br>
        <button type="button" onclick="InitBetriebstagebuch(document.getElementById('PasswortTextBox').value)" class="btn btn-primary">Anmelden</button>
    </div>

    <div class="container mt-5" id="AnmeldungFehlgeschlagen" style="display: none; text-align: center;"> 
        <strong style="font-size: 25pt; color: rgb(255, 255, 255);">Authentifizierung<br>fehlgeschlagen</strong><br><br>
        <button type="button" onclick="location.reload()" class="btn btn-danger">Erneut versuchen</button>
    </div>

    <div class="container mt-5" id="QRSCAN" style="display: none; text-align: center;">  
        <strong style="font-size: 25pt; color: rgb(255, 255, 255);">QR-CODE SCAN</strong><br><br>
        <button style="width: 100%;" class="btn btn-danger" onclick="QRSCAN_Abbrechen()">Scan Abbrechen</button>
        <br><br>
        <div id="qr-code-reader" style="width: 100%; height: 100%;"></div>
    </div>

    <div class="container mt-5" id="GesamteWebseite" style="display: none;">  
        <div class="form-group">
            <div class="row">

                <div class="ml-3" style="width: 80px; height: 80px;">
                    <img src="https://i.imgur.com/jUXw3Nh.png" style="width: 80px;" alt="">
                </div>
    
                <div class="ml-3">
                    <strong style="font-size: 18pt;"><strong>HGEG GmbH</strong><br>Betriebstagebuch</strong><br>
                </div>
    
            </div>

            <br>
            <hr style="background-color: white;">
            <button type="button" onclick="Hauptmenue_Seite_ButtonClicked()" class="btn btn-primary"><img src="https://i.imgur.com/WNbc9AA.png" class="mr-2" height="22px" alt="">Hauptmenü</button>
            <button type="button" onclick="EintragHinzufuegen_Seite_ButtonClicked()" style="margin-left: 15px;" class="btn btn-primary"><img src="https://i.imgur.com/WoPhKJy.png" class="mr-2" height="24px" alt="">Eintrag hinzufügen</button><br><br>
            <button onclick="Inventarsucher_Seite_ButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/k62MroZ.png" class="mr-2" height="24px" alt="">Inventarsucher</button>
            <button style="margin-left: 15px;" onclick="ZeiterfassungSeiteButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/j2CymSX.png" class="mr-2" height="26px" alt="">Zeiterfassung</button><br><br>
            <button onclick="CodeGenerator_Seite_ButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/CWOWIhQ.png" class="mr-2" height="26px" alt="">Code Generator</button>
            <button style="margin-left: 15px;" onclick="Statistik_ButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/TPgxiEc.png" class="mr-2" height="26px" alt="">Statistik</button><br><br>
            <button onclick="Aufgaben_ButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/jRDR3wY.png" class="mr-2" height="26px" alt="">Aufgaben</button>
            <button style="margin-left: 15px;" onclick="Zugzeit_ButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/H4x1kwH.png" class="mr-2" height="26px" alt="">Bus / Zugzeit</button><br><br>
            <button onclick="Fahrzeug_ButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/NNCZcDZ.png" class="mr-2" height="26px" alt="">Fahrzeuge</button>
            <hr style="background-color: white;"><br>

            <div id="Seite_AuflistungEinsaetze" style="display: block;">
                <strong style="font-size: 25pt;"><img src="https://i.imgur.com/3cAEXcj.png" height="42px" alt="">  Auflistung Einsätze</strong><br><br>


                <label for="datepicker">Datum:</label>
                <input type="date" onchange="ClearFlowLayoutPanel_Einsatzauflistung()" class="form-control" id="AusgewaehltesDatum" min="2023-08-01" placeholder="Datum auswählen"><br><br>
                <button type="button" onclick="ButtonEinsaetzeAnzeigenClicked()" class="btn btn-light">Einsätze anzeigen / aktualisieren</button>
                <br><br>
    
                <div id="FlowLayoutPanel_Einsatzauflistung">  
                    
                </div>
            </div>

            <div id="Seite_EintragHinzufuegen" style="display: none;">
                <strong style="font-size: 25pt;"><img src="https://i.imgur.com/WoPhKJy.png" height="42px" alt="">  Neuer Eintrag ...</strong><br><br>
                
                <label>Datum des Einsatzes ...</label>
                <input type="date" onchange="" class="form-control" id="AusgewaehltesDatumEintragHinzufuegen" min="2023-08-01" placeholder="Datum auswählen"><br>

                <label>Organisation (Herkunft der Beute) ...</label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="inputGroupSelect01" style="width: 120px;">Organisation</label>
                    </div>
                    <select class="custom-select" id="herkunftCombobox">
                        <option selected>Bitte auswählen ...</option>
                        <option value="Allgemein">HGEG-Allgemein</option>
                        <option value="Silgan">HGEG-Silgan</option>
                        <option value="Heinfels">HGEG-Heinfels</option>
                        <option value="Liftmull">HGEG-Liftmull</option>
                        <option value="ElektroAichner">HGEG-ElektroAichner</option>
                        <option value="Agetech">HGEG-Agetech</option>
                        <option value="PHTL">HGEG-PHTL</option>
                        <option value="Stauder">HGEG-Stauder</option>
                        <option value="Spezial">HGEG-Spezial</option>
                    </select>
                </div>

                <label>Anmerkungen / Zusatzinformationen zum Einsatz ...</label>
                <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon3" style="width: 120px;">Anmerkungen</span>
                </div>
                <input type="text" class="form-control" id="AnmerkungenTextBox" aria-describedby="basic-addon3">
                </div><br>

                <strong>Anwesende Personen:</strong><br>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="AndreasAnwesendCheckBox">
                    <label class="form-check-label" for="flexCheckDefault">
                        Köck Andreas
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="MarkusAnwesendCheckBox">
                    <label class="form-check-label" for="flexCheckDefault">
                        Unterweger Markus
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="KoeckMarkusAnwesendCheckBox">
                    <label class="form-check-label" for="flexCheckDefault">
                        Köck Markus
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="MarianAnwesendCheckBox">
                    <label class="form-check-label" for="flexCheckDefault">
                        Goller Marian
                    </label>
                </div>
                <br>

                <strong>Einkassierte Beute:</strong><br>

                <label>Details zum Artikel ...</label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3" style="width: 120px;">Anzahl</span>
                    </div>
                    <input type="text" class="form-control" id="AnzahlArtikelBeuteHinzufuegenTextBox" aria-describedby="basic-addon3">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3" style="width: 120px;">Bezeichnung</span>
                    </div>
                    <input type="text" class="form-control" id="BezeichnungArtikelBeuteHinzufuegenTextBox" aria-describedby="basic-addon3">
                </div><br>
                
                <button type="button" onclick="BeuteHinzufuegenButtonClicked()" class="btn btn-light"><img src="https://i.imgur.com/WoPhKJy.png" class="mr-2" height="24px" alt="">  Hinzufügen</button><br>
                <br>
                <hr style="background-color: white;">
                <br>
                <strong style="font-size: x-large;">Hinzugefügte Beute:</strong><br><br>
                <div id="AuflistungBeute_EintragHinzufuegen">                    
                    <img src="https://i.imgur.com/EELyqbg.png" width="50px" alt=""><strong class="ml-2">Noch keine Beute</strong>                       
                </div>

                <br><br>
                
                <!-- OK HAKEN LINK https://i.imgur.com/X94IPqU.png -->
                <button type="button" onclick="EintragSpeichern_BeuteHinzufuegenSeite_ButtonClicked()" class="btn btn-primary"><img src="https://i.imgur.com/WoPhKJy.png" class="mr-2" height="22px" alt="">Eintrag speichern</button><br>
                
                
                
                <br><br><br><br><br><br>
                
            </div>

            <div id="Seite_Inventarsucher" style="display: none;">

                <strong style="font-size: 25pt;"><img src="https://i.imgur.com/S75sM3Y.png" class="mr-2" height="40px" alt="">Inventarsucher</strong><br><br>

                <div id="Ladezeichen_Inventarsucher" style="display: block;">
                    <div class="spinner-border text-secondary" role="status" style="text-align: center;"></div><br><br>Suche wird initialisiert ...
                </div>

                <div id="Bedienoberflaeche_Inventarsucher" style="display: none;">
                    <label>Suche nach ...</label>
                    <div class="input-group-prepend">
                        <div class="input-group-text">
                            <input type="radio" onchange="Inventarsucher_SucheZuruecksetzen()" id="RadioButtonSucheNachInventarnummer" name="SucheRadioInventarsucher" aria-label="" checked><span style="margin-left: 8px;">Inventarnummer</span>
                        </div>
                        <br>
                        <div style="margin-left: 10px;" class="input-group-text">
                            <input type="radio" onchange="Inventarsucher_SucheZuruecksetzen()" id="RadioButtonSucheNachArtikel" name="SucheRadioInventarsucher" aria-label=""><span style="margin-left: 8px;">Artikel</span>
                        </div>
                    </div>

                    <br>

                    <label>Suche starten nach ...</label>
                    <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3">Suchtext</span>
                    </div>
                    <input type="text" oninput="" class="form-control" id="Suchtext_Inventarsucher_TextBox" aria-describedby="basic-addon3">
                    </div>
                    <button onclick="Suchtext_Inventarsucher_TextChanged()" type="submit" class="btn btn-primary"><img src="https://i.imgur.com/S75sM3Y.png" class="mr-2" height="22px" alt="">Suche starten</button> <button id="QRSCAN_Button_Suche" class="btn btn-light" onclick="ReadQRCode('Suchtext_Inventarsucher_TextBox', true)"><img src="https://i.imgur.com/TONSd5l.png" class="mr-2" height="22px" alt="">InvNr-Scan</button>
                    <br>
                    <br>
                    <label><strong style="font-size: x-large;" id="Suchergebnisse_Ueberschrift_Inventarsucher">Suchergebnisse: (0)</strong></label>
                    <div id="Suchergebnisse_Inventarsucher">
                        Bitte Suchtext eingeben ...
                    </div>
                </div>

            </div>

            <div id="Seite_Zeiterfassung" style="display: none">
                <strong style="font-size: 25pt;"><img src="https://i.imgur.com/j2CymSX.png" height="40px" alt=""> Zeiterfassung</strong><br><br>
                <button onclick="ZeiterfassungSeiteButtonClicked()" type="button" class="btn btn-light"><img src="https://i.imgur.com/EwOJCjs.png" class="mr-2" height="24px" alt="">Aktualisieren</button><br><br>

                

                <div id="Ladezeichen_Zeiterfassung" style="display: block;">
                    <div class="spinner-border text-secondary" role="status" style="text-align: center;"></div><br><br>Zeiterfassung wird initialisiert ...
                </div>

                <div id="Bedienoberflaeche_Zeiterfassung" style="display: none;">
                    <strong style="font-size: 20pt;">Übersicht Mitarbeiter</strong><br><br>
                    <table class="table table-dark table-sm" style="font-size: smaller;">
                        <thead>
                            <tr>
                            <th scope="col">Mitarbeiter</th>
                            <th scope="col">Jetzt anwesend</th>
                            <th scope="col">Gesamte Arbeitszeit</th>
                            </tr>
                        </thead>
                        <tbody id="Tabelle_Zeiterfassung_Uebersicht">
                            
                        </tbody>
                    </table>   
                    <br>
                    <strong style="font-size: 20pt;">Zeiterfassung Buchungen</strong><br><br>
                    <table class="table table-dark table-sm" style="font-size: smaller;">
                        <thead>
                            <tr>
                            <th scope="col">Mitarbeiter</th>
                            <th scope="col">Datum</th>
                            <th scope="col">Arbeitszeit</th>
                            <th scope="col">Dauer</th>
                            </tr>
                        </thead>
                        <tbody id="Tabelle_Zeiterfassung">
                            
                        </tbody>
                    </table> 
                    <br><br><br><br><br>    
                </div>
            </div>

            <div id="Seite_ArtikelBearbeiten" style="display: none;">
                <strong style="font-size: 25pt;" id="ArtikelBearbeitenUeberschrift">Artikel bearbeiten</strong><br>
                <div>Datenbank Pfad:<br><span id="ArtikelPfadInfo_ArtikelBearbeiten">Wird geladen ...</span></div><br>
                
                <div style="font-size: 15pt;">
                    <div>
                        <hr style="background-color: white;">
                        <strong style="font-size: 22pt;">Artikelname:</strong><br>
                        <strong>Aktueller Name:<br></strong> <span id="AktuellerArtikelName_BearbeitenSeite">Wird geladen ...</span><br><br>
                        <strong>Neuer Name:</strong><input id="NeuerArtikelName_BearbeitenSeite" type="text" class="form-control" placeholder="Neuer Name" aria-label="Neuer Wert" aria-describedby="basic-addon1"><br>
                        <button type="button" onclick="ArtikelBearbeiten_NameUeberschreibung_ButtonClicked()" class="btn btn-primary">Überschreiben</button><br>

                        <hr style="background-color: white;">
                        <strong style="font-size: 22pt;">Inventarnummer:</strong><br>
                        <strong>Aktuelle Inventarnummer:<br></strong> <span id="AktuelleInventarnummer_BearbeitenSeite">Wird geladen ...</span><br><br>
                        <strong>Neue Inventarnummer:</strong><input id="NeueInventarnummer_BearbeitenSeite" type="number" class="form-control" placeholder="Neue Inventarnummer" aria-label="Neuer Wert" aria-describedby="basic-addon1"><br>
                        <button type="button" onclick="ArtikelBearbeiten_InventarnummerUeberschreibung_ButtonClicked()" class="btn btn-primary">Überschreiben</button> <button class="btn btn-light" onclick="ReadQRCode('NeueInventarnummer_BearbeitenSeite', false)"><img src="https://i.imgur.com/TONSd5l.png" class="mr-2" height="22px" alt="">InvNr-Scan</button><br>

                        <hr style="background-color: white;">
                        <strong style="font-size: 22pt;">Beschreibung:</strong><br>
                        <strong>Aktuelle Beschreibung:<br></strong> <span id="AktuelleBeschreibung_BearbeitenSeite">Wird geladen ...</span><br><br>
                        <strong>Neue Beschreibung:</strong><input id="NeueBeschreibung_BearbeitenSeite" type="text" class="form-control" placeholder="Neue Beschreibung" aria-label="Neuer Wert" aria-describedby="basic-addon1"><br>
                        <button type="button" onclick="ArtikelBearbeiten_BeschreibungUeberschreibung_ButtonClicked()" class="btn btn-primary">Überschreiben</button><br>

                        <hr style="background-color: white;">
                        <strong style="font-size: 22pt;">Zustand:</strong><br>
                        <strong>Aktueller Zustand:<br></strong> <span id="AktuellerZustand_BearbeitenSeite">Wird geladen ...</span><br><br>
                        <strong>Neuer Zustand:</strong>
                        <select class="custom-select custom-select-lg mb-3" id="NeuerZustand_BearbeitenSeite">
                            <option value="Unbekannt">Unbekannt</option>
                            <option value="Funktioniert">Funktioniert</option>
                            <option value="FunktioniertTeilweise">FunktioniertTeilweise</option>                                    
                            <option value="Defekt">Defekt</option>
                        </select>
                        <button type="button" onclick="ArtikelBearbeiten_ZustandUeberschreibung_ButtonClicked()" class="btn btn-primary">Übernehmen</button><br>

                        <br><br><br><br><br><br>       
                    </div>                         
                </div>
            </div>


            <div id="Seite_CodeGenerator" style="display: none;">
                <strong style="font-size: larger;">Barcode-Download (A4 Seite)</strong><br><br>
                <button onclick="Download_BarcodePDF()" type="button" class="btn btn-light"><img src="https://i.imgur.com/3J4VDXQ.png" class="mr-2" height="22px" alt="">Herunterladen</button>


                <svg id="barcode" style="display: none;"></svg>

                <canvas id="CodeGeneratorCanvas"> 

                </canvas>
                <!-- <img src="https://barcode.tec-it.com/barcode.ashx?data=88887744%0A12234567&code=Code128&multiplebarcodes=true&translate-esc=on" alt=""> -->
            </div>

            <div id="Seite_Statistik" style="display: none; font-family: Russo One, sans-serif;">
                <strong style="font-size: 25pt;"><img class="mr-3" src="https://i.imgur.com/TPgxiEc.png" height="42px" alt="">HGEG Statistik</strong><br>
                 <br>
                <hr color="white">

                <div id="HGEG_Statistik_Ladezeichen" style="display: none;">
                    <br>
                    <div class="spinner-border text-secondary" role="status" style="text-align: center;"></div><br><br>Statistik wird erstellt ...
                </div>

                <div id="HGEG_Statistik_AnzeigeSeite" style="display: none;">
                    <br><strong style="font-size: x-large;">Einsätze:</strong><br>
                    <br>
                    <strong>Einsätze gesamt: </strong><strong id="GesamteAnzahlEinsaetze" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Erfolgreiche Einsätze: </strong><strong id="GesamteAnzahlEinsaetzeErfolgreich" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Fehlgeschlagene Einsätze: </strong><strong id="GesamteAnzahlEinsaetzeFehlschlag" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Erfolgsquote: </strong><strong id="Erfolgsquote" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <br>
                    <strong>Einsätze HGEG-Heinfels: </strong><strong id="Einsaetze_Heinfels" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Silgan: </strong><strong id="Einsaetze_Silgan" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Aichner: </strong><strong id="Einsaetze_ElektroAichner" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Spezial: </strong><strong id="Einsaetze_Spezial" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Liftmull: </strong><strong id="Einsaetze_Liftmull" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-PHTL: </strong><strong id="Einsaetze_PHTL" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Stauder: </strong><strong id="Einsaetze_Stauder" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Allgemein: </strong><strong id="Einsaetze_Allgemein" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze HGEG-Agetech: </strong><strong id="Einsaetze_Agetech" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>                
                    <hr color="white">
                    <br><strong style="font-size: x-large;">Mitarbeiter:</strong><br>
                    <br>
                    <strong>Einsätze Unterweger Markus: </strong><strong id="Einsaetze_UntM" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze Köck Andreas: </strong><strong id="Einsaetze_KoeA" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze Köck Markus: </strong><strong id="Einsaetze_KoeM" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <strong>Einsätze Goller Marian: </strong><strong id="Einsaetze_GolM" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong><br>
                    <hr color="white">
                    <br><strong style="font-size: x-large;">Artikel:</strong><br>
                    <br>
                    <strong>Anzahl Artikel gesamt: </strong><strong id="AnzahlArtikelGesamt" style="font-size: x-large; color: rgb(255, 179, 3)">0000</strong><br>
                    <strong>Defekte Artikel: </strong><strong id="AnzahlDefekteArtikel" style="font-size: x-large; color: rgb(255, 179, 3)">0000</strong><br>
                    <strong>Ausschuss: </strong><strong id="AnzahlDefekteArtikelProzent" style="font-size: x-large; color: rgb(255, 179, 3)">0000</strong><br>
                    <br>
                    <strong>Artikel HGEG-Heinfels: </strong><strong id="Artikel_Heinfels" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Heinfels_Prozent"></span><br>
                    <strong>Artikel HGEG-Silgan: </strong><strong id="Artikel_Silgan" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Silgan_Prozent"></span><br>
                    <strong>Artikel HGEG-Aichner: </strong><strong id="Artikel_ElektroAichner" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_ElektroAichner_Prozent"></span><br>
                    <strong>Artikel HGEG-Spezial: </strong><strong id="Artikel_Spezial" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Spezial_Prozent"></span><br>
                    <strong>Artikel HGEG-Liftmull: </strong><strong id="Artikel_Liftmull" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Liftmull_Prozent"></span><br>
                    <strong>Artikel HGEG-PHTL: </strong><strong id="Artikel_PHTL" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_PHTL_Prozent"></span><br>
                    <strong>Artikel HGEG-Stauder: </strong><strong id="Artikel_Stauder" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Stauder_Prozent"></span><br>
                    <strong>Artikel HGEG-Allgemein: </strong><strong id="Artikel_Allgemein" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Allgemein_Prozent"></span><br>
                    <strong>Artikel HGEG-Agetech: </strong><strong id="Artikel_Agetech" style="font-size: x-large; color: rgb(255, 179, 3)">000</strong> <span style="color: rgb(255, 179, 3)" id="Artikel_Agetech_Prozent"></span><br>

                    <br><br><br><br>
                </div>                
            </div>

            <div id="Seite_Aufgaben" style="display: none;">

                <div id="Ladezeichen_Aufgaben" style="display: block;">
                    <div class="spinner-border text-secondary" role="status" style="text-align: center;"></div><br><br>Aufgaben werden geladen ...
                </div>

                

                <div id="Seite_Aufgaben_AnzeigenContainer" style="display: none;">
                    <strong style="font-size: 25pt;"><img src="https://i.imgur.com/B3ShKX0.png" height="40px" alt=""> HGEG - Aufgaben</strong><br><br><hr style="background-color: white;">

                    <div id="Seite_Aufgaben_Anzeigen">
                        <button type="button" onclick="AufgabeHinzufuegen()" class="btn btn-light"><img src="https://i.imgur.com/WoPhKJy.png" height="26px" alt=""> Aufgabe hinzufügen</button><br><hr style="background-color: white;"><br>
                
                        
                        <div id="AuflistungAufgaben"></div>
                    </div>

                    <div id="Seite_Aufgaben_Hinzufuegen" style="display: none;">
                        <button class="btn btn-danger" onclick="AufgabenSeiteInit()"><img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt="">Abbrechen</button><br><hr style="background-color: white;"><br>
                    
                        <strong style="font-size: xx-large;">Aufgabe hinzufügen</strong>
                        <br><br>

                        <label>Um was geht es grob ?</label>
                        <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3" style="width: 110px;">Titel</span>
                        </div>
                        <input type="text" class="form-control" id="NeueAufgabe_Titel" aria-describedby="basic-addon3">
                        </div><br>
                        
                        <label>Was ist genau zu machen?</label>
                        <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3" style="width: 110px;">Details</span>
                        </div>
                        <input type="text" class="form-control" id="NeueAufgabe_Details" aria-describedby="basic-addon3">
                        </div><br>

                        <label>Wichtigkeit?</label>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01" style="width: 110px;">Wichtigkeit</label>
                            </div>
                            <select class="custom-select" id="NeueAufgabe_Wichtigkeit">
                                <option value="3">Normal</option>
                                <option value="2">Wichtig</option>
                                <option value="1">Essentiell</option>                                    
                            </select>
                        </div>

                        <br><button type="button" onclick="AufgabeSpeichern()" class="btn btn-light"><img src="https://i.imgur.com/WoPhKJy.png" height="26px" alt=""> Speichern</button>
                        

                    </div>


                    <br><br><br><br>
                </div>

                
            </div>

            <div id="Seite_Zugzeit" style="display: none;">
                <strong style="font-size: 25pt;"><img src="https://i.imgur.com/H4x1kwH.png" height="40px" alt=""> Bus / Zugzeit</strong><br><br>
                <hr style="background-color: white;">
                
                <strong style="font-size: x-large;">Aktuelle Uhrzeit:</strong> <span style="font-size: x-large;" id="Zugzeit_AktuelleUhrzeit"></span>
                <br>
                <hr style="background-color: white;"><br>
                <strong style="font-size: x-large;">Ankünfte Sillian:</strong><br><br>
                <iframe framborder="0" style="border:0px; width: 100%; height: 320px;" src="https://fahrplan.oebb.at/bin/stboard.exe/dn?L=vs_liveticker&evaId=1170728&boardType=arr&productsFilter=1011111111011&dirInput=&tickerID=arr&start=yes&eqstops=true&showJourneys=12&additionalTime=0"></iframe>
                <br><br>
                <strong style="font-size: x-large;">Abfahrten Sillian:</strong><br><br>
                <iframe framborder="0" style="border:0px; width: 100%; height: 320px;" src="https://fahrplan.oebb.at/bin/stboard.exe/dn?L=vs_liveticker&evaId=1170728&boardType=dep&productsFilter=1011111111011&dirInput=&tickerID=dep&start=yes&eqstops=true&showJourneys=12&additionalTime=0"></iframe>
            </div>

            <div id="Seite_FahrzeugGesamt" style="display: none;">
                <strong style="font-size: 25pt;"><img src="https://i.imgur.com/0ceqY7Y.png" height="40px" alt="">&nbsp;&nbsp;HGEG - Fahrzeuge</strong><br><br>
                <hr style="background-color: white;">

                <div id="FahrzeugSeite_Uebersicht" style="display: none;">
                    <br>
                    <button onclick="FahrzeugSuchen()" type="button" class="btn btn-light"><img src="https://i.imgur.com/k62MroZ.png" class="mr-2" height="24px" alt="">Fahrzeug suchen</button><br><br>
                    <button type="button" onclick="FahrzeugHinzufügen()" class="btn btn-primary"><img src="https://i.imgur.com/WoPhKJy.png" class="mr-2" height="24px" alt="">Fahrzeug hinzufügen</button>                  
                </div>

                <div id="FahrzeugSeite_Ladezeichen" style="display: none;">
                    <br>
                    <div class="spinner-border text-secondary" role="status" style="text-align: center;"></div><br><br>Lade Fahrzeugdatenbank ...
                </div>

                <div id="FahrzeugSeite_FahrzeugHinzufügen" style="display: none;">
                    <button class="btn btn-danger" onclick="FahrzeugSeiteInit()"><img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt="">Vorgang abbrechen</button><br><hr style="background-color: white;"><br>
                    
                    <strong style="font-size: xx-large;">Fahrzeug hinzufügen</strong>
                    <br><br>

                    <label>Names des neuen Fahrzeuges ...</label>
                    <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3" style="width: 110px;">Name</span>
                    </div>
                    <input type="text" class="form-control" id="NeuesFzg_Name" aria-describedby="basic-addon3">
                    </div><br>
                    
                    <label>Beschreibung des Fahrzeuges ...</label>
                    <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3" style="width: 110px;">Details</span>
                    </div>
                    <input type="text" class="form-control" id="NeuesFzg_Beschreibung" aria-describedby="basic-addon3">
                    </div><br>

                    <label>Foto Link-URL (z.B. Imgur)</label>
                    <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3" style="width: 110px;">Foto</span>
                    </div>
                    <input type="text" class="form-control" id="NeuesFzg_Foto" aria-describedby="basic-addon3">
                    </div><br>

                    <br><button type="button" onclick="FahrzeugSpeichern()" class="btn btn-light"><img src="https://i.imgur.com/WoPhKJy.png" height="26px" alt=""> Speichern</button>
                    
                </div>

                <div id="FahrzeugSeite_FahrzeugSuchen" style="display: none;">
                    <button class="btn btn-danger" onclick="FahrzeugSeiteInit()"><img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt="">Suche abbrechen</button><br><hr style="background-color: white;"><br>
                    
                    <strong style="font-size: xx-large;">Fahrzeug suchen</strong>
                    <br><br>

                    <label>Suche nach ...</label>
                    <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3">Suche</span>
                    </div>
                    <input type="text" class="form-control" id="FzgSuche_TextBox" oninput="FahrzeugSuchenTextboxTextChanged()" aria-describedby="basic-addon3">
                    </div>
                    <br>  
                    <hr style="background-color: white;">
                    <br>

                    <div id="FzgSucheAuflistung"></div>
                    
                </div>

                <div id="FahrzeugSeite_Details" style="display: none;">
                    <button class="btn btn-danger" onclick="FahrzeugSeiteZurueckZurSuche()"><img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt="">Zurück zur Suche</button><br><hr style="background-color: white;"><br>
                    
                    <strong style="font-size: xx-large;" id="FahrzeugDetails_Name">FzgName</strong><br><br>

                    <strong style="font-size: larger;">Beschreibung:</strong><br><span style="font-size: larger;" id="FahrzeugDetails_Beschreibung">FzgBeschr</span>
                    <br><br>

                    <img src="https://i.imgur.com/aLU1B11.jpeg" id="FahrzeugDetails_FotoURL" style="width: 100%;" alt=""><br><br>

                    <strong style="font-size: larger;">Fahrzeug Status:</strong><br><br>
                    <div id="FahrzeugDetails_FzgGesperrt" style="display: none;">
                        <div class="alert alert-danger" role="alert">
                            <img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt=""><span id="FahrzeugGesperrtInformationDatum">Fahrzeug gesperrt!</span>                                           
                        </div>
    
                        <strong style="font-size: larger;">Fahrzeugstandort:</strong><br><span style="font-size: larger;" id="FahrzeugDetails_AbgestelltOrt">FzgStandort</span>
                        <br><br>
                    </div>
                    

                    <div class="alert alert-success" role="alert" id="FahrzeugDetails_FzgEinsatzfaehig" style="display: none;">
                        <img src="https://i.imgur.com/X94IPqU.png" class="mr-2" height="22px" alt=""> Fahrzeug ist einsatzfähig!
                    </div>

                    <div id="FahrzeugDetails_FzgMaengelVorhanden" style="display: none;">                        
                        <div class="alert alert-warning" role="alert">
                            <img src="https://i.imgur.com/atRxfOG.png" class="mr-2" height="22px" alt=""> Mängel vorhanden!
                        </div>

                        <strong style="font-size: larger;">Fahrzeug Mängelliste:</strong><br>
                        <div id="FahrzeugMaengelAuflistung">
                            
                        </div>
                        <br>
                    </div>

                    <br>
                    <div id="Fahrzeug_Aktionen_Button" style="display: block;">
                        <button onclick="FahrzeugAktionenSteuerelementeEinblenden()" type="button" class="btn btn-light"><img src="https://i.imgur.com/jRDR3wY.png" class="mr-2" height="26px" alt="">Bearbeiten</button>
                    </div>
                    
                    <div id="Fahrzeug_Aktionen_Steuerelemente" style="display: none;">
                        <hr style="background-color: white;"><strong style="font-size: larger;">Aktionen:</strong><br><br>

                        <div id="ButtonFahrzeugSperren">
                            <label>Neuer Standort ...</label>
                            <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon3">Ort</span>
                            </div>
                            <input type="text" class="form-control" id="FzgAbstellenNeuerAbstellort" aria-describedby="basic-addon3">
                            </div>
    
                            <button class="btn btn-light" onclick="AktuellesFahrzeugSperrzustandVeraendern(true)"><img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt="">Fahrzeug sperren</button>
                        </div>
                        
                        <button class="btn btn-light" id="ButtonFahrzeugEntsperren" onclick="AktuellesFahrzeugSperrzustandVeraendern(false)"><img src="https://i.imgur.com/X94IPqU.png" class="mr-2" height="22px" alt="">Fahrzeug entsperren</button>
                        <br><br>
    
                        <label>Mangel hinzufügen ...</label>
                        <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Mangel</span>
                        </div>
                        <input type="text" class="form-control" id="FzgNeuerMangelTextbox" aria-describedby="basic-addon3">
                        </div>
                        <button class="btn btn-warning" id="ButtonFahrzeugEntsperren" onclick="AktuellsFahrzeugMangelHinzufuegen()"><img src="https://i.imgur.com/WoPhKJy.png" class="mr-2" height="22px" alt="">Mangel hinzufügen</button>    
                    </div>
                </div>

                <br><br><br><br>
            </div>
        </div>
    </div>
</body>
</html>


<!-- Fahrzeug Seiten -->
<script>
    var FahrzeugSeite_Uebersicht = e("FahrzeugSeite_Uebersicht")
    var FahrzeugSeite_FahrzeugSuchen = e("FahrzeugSeite_FahrzeugSuchen")
    var FahrzeugSeite_FahrzeugHinzufügen = e("FahrzeugSeite_FahrzeugHinzufügen")
    var FahrzeugSeite_Ladezeichen = e("FahrzeugSeite_Ladezeichen")
    var FahrzeugSeite_Details = e("FahrzeugSeite_Details")

    var NeuesFzg_Name = e("NeuesFzg_Name")
    var NeuesFzg_Beschreibung = e("NeuesFzg_Beschreibung")
    var NeuesFzg_Foto = e("NeuesFzg_Foto")
    var FzgSuche_TextBox = e("FzgSuche_TextBox")
    var FzgSucheAuflistung = e("FzgSucheAuflistung")

    function FahrzeugSeiteInit()
    {
        Show(FahrzeugSeite_Uebersicht)
        Hide(FahrzeugSeite_FahrzeugSuchen)
        Hide(FahrzeugSeite_Ladezeichen)
        Hide(FahrzeugSeite_FahrzeugHinzufügen)
        Hide(FahrzeugSeite_Details)
    }

    function FahrzeugHinzufügen()
    {
        NeuesFzg_Name.value = ""
        NeuesFzg_Beschreibung.value = ""
        NeuesFzg_Foto.value = ""

        Hide(FahrzeugSeite_Uebersicht)
        Hide(FahrzeugSeite_FahrzeugSuchen)
        Hide(FahrzeugSeite_Ladezeichen)
        Show(FahrzeugSeite_FahrzeugHinzufügen)
        Hide(FahrzeugSeite_Details)
    }

    function FahrzeugSeiteZurueckZurSuche()
    {        
        Hide(FahrzeugSeite_Uebersicht)
        Show(FahrzeugSeite_FahrzeugSuchen)
        Hide(FahrzeugSeite_Ladezeichen)
        Hide(FahrzeugSeite_FahrzeugHinzufügen)
        Hide(FahrzeugSeite_Details)
    }
    
    function FahrzeugSpeichern()
    {
        var FahrzeugId = new Date().getTime()
        var NeuerName = NeuesFzg_Name.value
        var NeueBeschr = NeuesFzg_Beschreibung.value
        var NeueFotoURL = NeuesFzg_Foto.value


        if(NeuerName == "" || NeueBeschr == "")
        {
            alert("Fehlerhafte Eingaben")
        }
        else
        {
            (async () =>
            {                 
                Hide(FahrzeugSeite_Uebersicht)
                Hide(FahrzeugSeite_FahrzeugSuchen)
                Show(FahrzeugSeite_Ladezeichen)
                Hide(FahrzeugSeite_FahrzeugHinzufügen)
                Hide(FahrzeugSeite_Details)
                
                await SetVariable(`Fahrzeuge/${FahrzeugId}/Name`, NeuerName)
                await SetVariable(`Fahrzeuge/${FahrzeugId}/Beschreibung`, NeueBeschr)
                await SetVariable(`Fahrzeuge/${FahrzeugId}/FotoURL`, NeueFotoURL)
                await SetVariable(`Fahrzeuge/${FahrzeugId}/Gesperrt`, false)
                await SetVariable(`Fahrzeuge/${FahrzeugId}/OrtAbgestellt`, "")
                await SetVariable(`Fahrzeuge/${FahrzeugId}/Name`, NeuerName)
                await SetVariable(`Fahrzeuge/${FahrzeugId}/LichtOK`, false)

                FahrzeugSeiteInit()
            })()

        }
    }

    var Fahrzeugdatenbank = []

    function FahrzeugSuchen()
    {
        (async () =>
        {                 
            Hide(FahrzeugSeite_Uebersicht)
            Hide(FahrzeugSeite_FahrzeugSuchen)
            Show(FahrzeugSeite_Ladezeichen)
            Hide(FahrzeugSeite_FahrzeugHinzufügen)
            Hide(FahrzeugSeite_Details)

            Fahrzeugdatenbank = Object.entries(await GetVariable("Fahrzeuge"))
            FzgSuche_TextBox.value = ""
            FzgSucheAuflistung.innerHTML = ""

            Hide(FahrzeugSeite_Uebersicht)
            Show(FahrzeugSeite_FahrzeugSuchen)
            Hide(FahrzeugSeite_Ladezeichen)
            Hide(FahrzeugSeite_FahrzeugHinzufügen)
            Hide(FahrzeugSeite_Details)
        })()
    }

    function FahrzeugSuchenTextboxTextChanged()
    {
        FzgSucheAuflistung.innerHTML = ""
        var Suchtext = FzgSuche_TextBox.value
        
        if(Suchtext != "")
        {
              for (var [FahrzeugId, Fahrzeug] of Fahrzeugdatenbank)
            {
                if(Fahrzeug.Name.toLowerCase().includes(Suchtext.toLowerCase()) || Suchtext == "*")
                {
                    FzgSucheAuflistung.innerHTML += `<div style="background-color: rgb(70, 70, 70); border-radius: 10px; padding: 15px;">
                        <strong style="font-size: x-large; color: white;"><img src="https://i.imgur.com/0ceqY7Y.png" class="mr-2" height="26px" alt="">${Fahrzeug.Name}</strong><br><br>
                        <strong>Beschreibung</strong>:<br>${Fahrzeug.Beschreibung}<br><br>
                        <button type="button" onclick="FahrzeugSuchenDetailsButtonClicked('${FahrzeugId}')" class="btn btn-primary">Details anzeigen</button>
                    </div>
                    <br> `
                }
            }
        }

        if(FzgSucheAuflistung.innerHTML == "")
        {
            FzgSucheAuflistung.innerHTML = '<img src="https://i.imgur.com/EELyqbg.png" width="50px" alt=""><strong class="ml-2">Keine Suchergebnisse gefunden</strong>'
        }
    }

    var FahrzeugDetails_AktuelleFahrzeugId = ""

    var FahrzeugDetails_Name = e("FahrzeugDetails_Name")
    var FahrzeugDetails_FotoURL = e("FahrzeugDetails_FotoURL")
    var FahrzeugDetails_FzgGesperrt = e("FahrzeugDetails_FzgGesperrt")
    var FahrzeugDetails_AbgestelltOrt = e("FahrzeugDetails_AbgestelltOrt")
    var FahrzeugDetails_FzgEinsatzfaehig = e("FahrzeugDetails_FzgEinsatzfaehig")
    var FahrzeugDetails_FzgMaengelVorhanden = e("FahrzeugDetails_FzgMaengelVorhanden")
    var FahrzeugDetails_Beschreibung = e("FahrzeugDetails_Beschreibung")
    var ButtonFahrzeugSperren = e("ButtonFahrzeugSperren")
    var ButtonFahrzeugEntsperren = e("ButtonFahrzeugEntsperren")
    var FahrzeugMaengelAuflistung = e("FahrzeugMaengelAuflistung")
    var FzgAbstellenNeuerAbstellort = e("FzgAbstellenNeuerAbstellort")
    var Fahrzeug_Aktionen_Steuerelemente = e("Fahrzeug_Aktionen_Steuerelemente")
    var Fahrzeug_Aktionen_Button = e("Fahrzeug_Aktionen_Button")
    var FahrzeugGesperrtInformationDatum = e("FahrzeugGesperrtInformationDatum")

    function FahrzeugSuchenDetailsButtonClicked(FahrzeugId)
    {
        (async () =>
        {                
            FahrzeugDetails_AktuelleFahrzeugId = FahrzeugId

            Hide(FahrzeugSeite_Uebersicht)
            Hide(FahrzeugSeite_FahrzeugSuchen)        
            Hide(FahrzeugSeite_FahrzeugHinzufügen)
            Show(FahrzeugSeite_Ladezeichen)
            Hide(FahrzeugSeite_Details)

            Hide(FahrzeugDetails_FzgGesperrt)
            Hide(FahrzeugDetails_FzgEinsatzfaehig)
            Hide(FahrzeugDetails_FzgMaengelVorhanden)
            Hide(ButtonFahrzeugSperren)
            Hide(ButtonFahrzeugEntsperren)

            FzgNeuerMangelTextbox.value = ""
            FahrzeugMaengelAuflistung.innerHTML = ""
            FahrzeugGesperrtInformationDatum.innerHTML = "Fahrzeug gesperrt!"
            Hide(Fahrzeug_Aktionen_Steuerelemente)
            Show(Fahrzeug_Aktionen_Button)

            var FzgFotoURL = await GetVariable(`Fahrzeuge/${FahrzeugId}/FotoURL`)
            FahrzeugDetails_FotoURL.src = FzgFotoURL

            var FzgName = await GetVariable(`Fahrzeuge/${FahrzeugId}/Name`)
            var FzgBeschreibung = await GetVariable(`Fahrzeuge/${FahrzeugId}/Beschreibung`)            
            var FzgGesperrt = await GetVariable(`Fahrzeuge/${FahrzeugId}/Gesperrt`)
            var FzgMaengelliste = await GetVariable(`Fahrzeuge/${FahrzeugId}/Maengelliste`)
            var FzgOrtAbgestellt = await GetVariable(`Fahrzeuge/${FahrzeugId}/OrtAbgestellt`)
            var FzgAbgestelltSeit = await GetVariable(`Fahrzeuge/${FahrzeugId}/AbgestelltSeit`)

            FahrzeugDetails_Name.innerHTML = FzgName
            FahrzeugDetails_Beschreibung.innerHTML = FzgBeschreibung            
            FahrzeugDetails_AbgestelltOrt.innerHTML = FzgOrtAbgestellt

            if(FzgGesperrt)
            {
                Show(FahrzeugDetails_FzgGesperrt)
                Show(ButtonFahrzeugEntsperren)
                FahrzeugGesperrtInformationDatum.innerHTML = `Fzg gesperrt und abgestellt seit ${GetDatumString(new Date(parseInt(FzgAbgestelltSeit)))}`
            }
            else
            {
                Show(FahrzeugDetails_FzgEinsatzfaehig) 
                Show(ButtonFahrzeugSperren)               
            }


            if(FzgMaengelliste != null)
            {
                var AnzahlMaengelGesamt = 0               

                var FzgMaengellisteArray = Object.entries(FzgMaengelliste)
                for (var [MangelId, MangelEintrag] of FzgMaengellisteArray)
                {
                    if(!MangelEintrag.Behoben)
                    {
                        FahrzeugMaengelAuflistung.innerHTML +=
                        `<div>
                            <img src="https://i.imgur.com/atRxfOG.png" class="mr-2" height="22px" alt=""><span class="mr-2">${MangelEintrag.Mangel}</span><a href="#" onclick="if(confirm('Willst du den Mangel\\n\\n${MangelEintrag.Mangel}\\n\\nwirklich entfernen?')) {AktuellesFahrzeugMangelEntfernen('${MangelId}')} " class="badge badge-success">Mangel entfernen</a><br>
                        </div> `

                        AnzahlMaengelGesamt++
                    }                    
                }

                if(AnzahlMaengelGesamt > 0)
                {
                    Show(FahrzeugDetails_FzgMaengelVorhanden)
                }
            }

            Hide(FahrzeugSeite_Ladezeichen)
            Show(FahrzeugSeite_Details)
        })()
    }    

    function AktuellesFahrzeugSperrzustandVeraendern(NeuerZustand)
    {
        if(FahrzeugDetails_AktuelleFahrzeugId != "")
        {
            (async () =>
            {                 
                var SchreibenErlaubt = true;

                if(NeuerZustand == true) //Wenn das Fzg gesperrt wird
                {
                    var NeuerStandort = FzgAbstellenNeuerAbstellort.value

                    if(NeuerStandort == "")
                    {
                        SchreibenErlaubt = false
                    }
                    else
                    {
                        await SetVariable(`Fahrzeuge/${FahrzeugDetails_AktuelleFahrzeugId}/OrtAbgestellt`, NeuerStandort)
                        await SetVariable(`Fahrzeuge/${FahrzeugDetails_AktuelleFahrzeugId}/AbgestelltSeit`, new Date().getTime())
                    }
                }

                if(SchreibenErlaubt)
                {
                    await SetVariable(`Fahrzeuge/${FahrzeugDetails_AktuelleFahrzeugId}/Gesperrt`, NeuerZustand)
                    FahrzeugSuchenDetailsButtonClicked(FahrzeugDetails_AktuelleFahrzeugId)
                }
                else
                {
                    alert("Fehlerhafte Eingabe!")
                }
                
            })()
        }
    }

    function AktuellsFahrzeugMangelHinzufuegen()
    {
        var NeuerMangel = FzgNeuerMangelTextbox.value
        var MangelId = new Date().getTime()

        if(NeuerMangel == "")
        {
            alert("Fehlerhafte Eingabe")
        }
        else
        {
            (async () =>
            {                 
                await SetVariable(`Fahrzeuge/${FahrzeugDetails_AktuelleFahrzeugId}/Maengelliste/${MangelId}/Mangel`, NeuerMangel)
                await SetVariable(`Fahrzeuge/${FahrzeugDetails_AktuelleFahrzeugId}/Maengelliste/${MangelId}/Behoben`, false)
                FzgNeuerMangelTextbox.value = ""
                FahrzeugSuchenDetailsButtonClicked(FahrzeugDetails_AktuelleFahrzeugId)
            })()
        }
    }

    function AktuellesFahrzeugMangelEntfernen(MangelId)
    {
        (async () =>
        {                 
            await SetVariable(`Fahrzeuge/${FahrzeugDetails_AktuelleFahrzeugId}/Maengelliste/${MangelId}/Behoben`, true)
            FahrzeugSuchenDetailsButtonClicked(FahrzeugDetails_AktuelleFahrzeugId)
        })()
    }

    function FahrzeugAktionenSteuerelementeEinblenden()
    {
        Show(Fahrzeug_Aktionen_Steuerelemente)
        Hide(Fahrzeug_Aktionen_Button)
    }
</script>

<!-- Zugzeit -->
<script>



    var Zugzeit_AktuelleUhrzeit = e("Zugzeit_AktuelleUhrzeit")

    function ZugzeitSeiteInit()
    {
        (async () =>
        {                 



        })()   
    }


    setInterval(() =>
    {
        Zugzeit_AktuelleUhrzeit.innerHTML = GetTimeStringSeconds(new Date())
    }, 1000);

</script>

<!-- Statistik -->
<script>
    function Event_Statistik_Load()
    {        
        // FUER TESTZWECKE
        // var Statistik_Grunddaten = JSON.parse(localStorage.Statistik_Grunddaten);
        // console.log(Statistik_Grunddaten);
        // Statistik_Auswerten(Statistik_Grunddaten);        

        (async () =>
        {                     
            e("HGEG_Statistik_Ladezeichen").style.display = "block"
            e("HGEG_Statistik_AnzeigeSeite").style.display = "none"

            var G = await GetVariable("eintraege")

            // FUER TESTZWECKE
            // localStorage.setItem("Statistik_Grunddaten", JSON.stringify(G))

            Statistik_Auswerten(G);
        })()
    }

    function Statistik_Auswerten(Statistik_Grunddaten)
    {
        var AlleEinsaetze = Object.entries(Statistik_Grunddaten)

        var GesamteAnzahlEinsaetzeErfolgreich = 0
        var GesamteAnzahlEinsaetzeFehlschlag = 0

        var Einsaetze_UntM = 0
        var Einsaetze_KoeA = 0
        var Einsaetze_KoeM = 0
        var Einsaetze_GolM = 0

        var AnzahlEinsaetzeAllgemein = 0
        var AnzahlEinsaetzeSilgan = 0
        var AnzahlEinsaetzeHeinfels = 0
        var AnzahlEinsaetzeLiftmull = 0
        var AnzahlEinsaetzeElektroAichner = 0
        var AnzahlEinsaetzeAgetech = 0
        var AnzahlEinsaetzePHTL = 0
        var AnzahlEinsaetzeStauder = 0
        var AnzahlEinsaetzeSpezial = 0

        var AnzahlArtikelGesamt = 0

        var AnzahlArtikelAllgemein = 0
        var AnzahlArtikelSilgan = 0
        var AnzahlArtikelHeinfels = 0
        var AnzahlArtikelLiftmull = 0
        var AnzahlArtikelElektroAichner = 0
        var AnzahlArtikelAgetech = 0
        var AnzahlArtikelPHTL = 0
        var AnzahlArtikelStauder = 0
        var AnzahlArtikelSpezial = 0

        var AnzahlDefekteArtikel = 0

    
        for (var [EinsatzId, Einsatz] of AlleEinsaetze)
        {
            if(Einsatz.herkunft == "Allgemein") { AnzahlEinsaetzeAllgemein++; }
            else if(Einsatz.herkunft == "Silgan") { AnzahlEinsaetzeSilgan++; }
            else if(Einsatz.herkunft == "Heinfels") { AnzahlEinsaetzeHeinfels++; }
            else if(Einsatz.herkunft == "Liftmull") { AnzahlEinsaetzeLiftmull++; }
            else if(Einsatz.herkunft == "ElektroAichner") { AnzahlEinsaetzeElektroAichner++; }
            else if(Einsatz.herkunft == "Agetech") { AnzahlEinsaetzeAgetech++; }
            else if(Einsatz.herkunft == "PHTL") { AnzahlEinsaetzePHTL++; }
            else if(Einsatz.herkunft == "Stauder") { AnzahlEinsaetzeStauder++; }
            else if(Einsatz.herkunft == "Spezial") { AnzahlEinsaetzeSpezial++; }

            if(Einsatz.UntM) { Einsaetze_UntM++ }
            if(Einsatz.KoeA) { Einsaetze_KoeA++ }
            if(Einsatz.KoeM || Einsatz.Anmerkungen.includes("KoeckMarkus")) { Einsaetze_KoeM++ }
            if(Einsatz.GolM || Einsatz.Anmerkungen.includes("Marian")) { Einsaetze_GolM++ }

            if(typeof Einsatz.artikelListe === "object")
            {
                GesamteAnzahlEinsaetzeErfolgreich++              

                for(Artikel of Einsatz.artikelListe)
                {
                    if(Artikel != null)
                    {
                        AnzahlArtikelGesamt++

                        if(Einsatz.herkunft == "Allgemein") { AnzahlArtikelAllgemein++; }
                        else if(Einsatz.herkunft == "Silgan") { AnzahlArtikelSilgan++; }
                        else if(Einsatz.herkunft == "Heinfels") { AnzahlArtikelHeinfels++; }
                        else if(Einsatz.herkunft == "Liftmull") { AnzahlArtikelLiftmull++; }
                        else if(Einsatz.herkunft == "ElektroAichner") { AnzahlArtikelElektroAichner++; }
                        else if(Einsatz.herkunft == "Agetech") { AnzahlArtikelAgetech++; }
                        else if(Einsatz.herkunft == "PHTL") { AnzahlArtikelPHTL++; }
                        else if(Einsatz.herkunft == "Stauder") { AnzahlArtikelStauder++; }
                        else if(Einsatz.herkunft == "Spezial") { AnzahlArtikelSpezial++; }

                        if(Artikel.zustand == "Defekt")
                        {
                            AnzahlDefekteArtikel++
                        }
                    }                    
                }
            }
        }

        GesamteAnzahlEinsaetzeFehlschlag = AlleEinsaetze.length - GesamteAnzahlEinsaetzeErfolgreich

        e("GesamteAnzahlEinsaetze").innerHTML = AlleEinsaetze.length
        e("GesamteAnzahlEinsaetzeErfolgreich").innerHTML = GesamteAnzahlEinsaetzeErfolgreich
        e("GesamteAnzahlEinsaetzeFehlschlag").innerHTML = GesamteAnzahlEinsaetzeFehlschlag
        e("Erfolgsquote").innerHTML = `${((GesamteAnzahlEinsaetzeErfolgreich / AlleEinsaetze.length) * 100).toFixed(1)}%`

        e("Einsaetze_Heinfels").innerHTML = AnzahlEinsaetzeHeinfels
        e("Einsaetze_Silgan").innerHTML = AnzahlEinsaetzeSilgan
        e("Einsaetze_ElektroAichner").innerHTML = AnzahlEinsaetzeElektroAichner
        e("Einsaetze_Spezial").innerHTML = AnzahlEinsaetzeSpezial
        e("Einsaetze_Liftmull").innerHTML = AnzahlEinsaetzeLiftmull
        e("Einsaetze_Stauder").innerHTML = AnzahlEinsaetzeStauder
        e("Einsaetze_PHTL").innerHTML = AnzahlEinsaetzePHTL
        e("Einsaetze_Allgemein").innerHTML = AnzahlEinsaetzeAllgemein
        e("Einsaetze_Agetech").innerHTML = AnzahlEinsaetzeAgetech

        e("Einsaetze_UntM").innerHTML = Einsaetze_UntM
        e("Einsaetze_KoeA").innerHTML = Einsaetze_KoeA
        e("Einsaetze_KoeM").innerHTML = Einsaetze_KoeM
        e("Einsaetze_GolM").innerHTML = Einsaetze_GolM

        e("AnzahlArtikelGesamt").innerHTML = AnzahlArtikelGesamt

        e("Artikel_Heinfels").innerHTML = AnzahlArtikelHeinfels
        e("Artikel_Silgan").innerHTML = AnzahlArtikelSilgan
        e("Artikel_ElektroAichner").innerHTML = AnzahlArtikelElektroAichner
        e("Artikel_Spezial").innerHTML = AnzahlArtikelSpezial
        e("Artikel_Liftmull").innerHTML = AnzahlArtikelLiftmull
        e("Artikel_Stauder").innerHTML = AnzahlArtikelStauder
        e("Artikel_PHTL").innerHTML = AnzahlArtikelPHTL
        e("Artikel_Allgemein").innerHTML = AnzahlArtikelAllgemein
        e("Artikel_Agetech").innerHTML = AnzahlArtikelAgetech

        e("Artikel_Heinfels_Prozent").innerHTML = `(${((AnzahlArtikelHeinfels / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_Silgan_Prozent").innerHTML = `(${((AnzahlArtikelSilgan / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_ElektroAichner_Prozent").innerHTML = `(${((AnzahlArtikelElektroAichner / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_Spezial_Prozent").innerHTML = `(${((AnzahlArtikelSpezial / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_Liftmull_Prozent").innerHTML = `(${((AnzahlArtikelLiftmull / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_Stauder_Prozent").innerHTML = `(${((AnzahlArtikelStauder / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_PHTL_Prozent").innerHTML = `(${((AnzahlArtikelPHTL / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_Allgemein_Prozent").innerHTML = `(${((AnzahlArtikelAllgemein / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`
        e("Artikel_Agetech_Prozent").innerHTML = `(${((AnzahlArtikelAgetech / AnzahlArtikelGesamt) * 100).toFixed(1)}%)`

        e("AnzahlDefekteArtikel").innerHTML = AnzahlDefekteArtikel;
        e("AnzahlDefekteArtikelProzent").innerHTML = `${((AnzahlDefekteArtikel / AnzahlArtikelGesamt) * 100).toFixed(1)}%`

        e("HGEG_Statistik_Ladezeichen").style.display = "none"
        e("HGEG_Statistik_AnzeigeSeite").style.display = "block"
    }



    function GetEinsatzId(ArtikelPfad)
    {
        return ArtikelPfad.split("/")[1]
    }
</script>

<!-- Aufgaben -->
<script>

    var Ladezeichen_Aufgaben = e("Ladezeichen_Aufgaben")
    var Seite_Aufgaben_AnzeigenContainer = e("Seite_Aufgaben_AnzeigenContainer")
    var Seite_Aufgaben_Anzeigen = e("Seite_Aufgaben_Anzeigen")
    var Seite_Aufgaben_Hinzufuegen = e("Seite_Aufgaben_Hinzufuegen")
    var AuflistungAufgaben = e("AuflistungAufgaben")

    function AufgabenSeiteInit()
    {
        (async () =>
        {             
            AuflistungAufgaben.innerHTML = ""

            Ladezeichen_Aufgaben.style.display = "block"
            
            Seite_Aufgaben_AnzeigenContainer.style.display = "none"
            Seite_Aufgaben_Anzeigen.style.display = "none"
            Seite_Aufgaben_Hinzufuegen.style.display = "none"

            var AlleAufgabenObjekt = await GetVariable("Aufgaben")
            var AlleAufgaben = Object.entries(AlleAufgabenObjekt)

            AlleAufgaben.sort((a, b) => a[1].Wichtigkeit - b[1].Wichtigkeit);

            for (var [AufgabeId, Aufgabe] of AlleAufgaben)
            {
                if(Aufgabe.ErledigtAm == "")
                {
                    var Farbe = "rgb(70, 70, 70)"
                    var WichtigkeitString = "AUFGABE"

                    if(Aufgabe.Wichtigkeit == 1) // SEHR WICHTIG
                    {
                        Farbe = "rgb(136, 63, 63)"
                        WichtigkeitString = "ESSENTIELLE AUFGABE"
                    }
                    else if(Aufgabe.Wichtigkeit == 2) //WICHTIG
                    {
                        Farbe = "rgb(134, 84, 51)"
                        WichtigkeitString = "WICHTIGE AUFGABE"
                    }

                    AuflistungAufgaben.innerHTML += `
                    <div style="background-color: ${Farbe}; border-radius: 10px; padding: 15px;">
                        <strong style="font-size: x-large; color: white;" class="mb-4"><img src="https://i.imgur.com/3UD0Fsc.png" class="mr-2" height="50px" alt="">${WichtigkeitString}<br><span style="font-size: smaller;">${Aufgabe.Titel}</span></strong><br>
                        
                        <span>${Aufgabe.Details}</span><br><br>

                        <strong>Hinzugefügt am: </strong>${GetDatumString(new Date(parseInt(AufgabeId)))} um ${GetTimeString(new Date(parseInt(AufgabeId)))}<br>
                        <span>Bereits ${(((new Date().getTime() - parseInt(AufgabeId)) / 1000) /  86400).toFixed(1)} Tage aufgeschoben.</span>
                        <br><br>
                        
                        <button type="button" onclick="AufgabeAlsErledigtMarkieren('${AufgabeId}')" class="btn btn-light"><img src="https://i.imgur.com/u9e8ShY.png" height="26px" alt=""> Erledigt</button>
                    </div><br> `   
                }                
            }

            if(AuflistungAufgaben.innerHTML == "")
            {
                AuflistungAufgaben.innerHTML = `<img src="https://i.imgur.com/u9e8ShY.png" height="60px" alt=""><br><br><strong style="font-size: x-large;">Aktuell keine Aufgaben</strong>`
            }

            AufgabenSeiteInitAbgeschlossen();
        })()
    }

    function AufgabenSeiteInitAbgeschlossen()
    {
        Ladezeichen_Aufgaben.style.display = "none"
                
        Seite_Aufgaben_AnzeigenContainer.style.display = "block"
        Seite_Aufgaben_Anzeigen.style.display = "block"
        Seite_Aufgaben_Hinzufuegen.style.display = "none"
    }

    function AufgabeHinzufuegen()
    {
        e("NeueAufgabe_Titel").value = ""
        e("NeueAufgabe_Details").value = ""
        e("NeueAufgabe_Wichtigkeit").value = "3"

        Ladezeichen_Aufgaben.style.display = "none"
            
        Seite_Aufgaben_AnzeigenContainer.style.display = "block"
        Seite_Aufgaben_Anzeigen.style.display = "none"
        Seite_Aufgaben_Hinzufuegen.style.display = "block"        
    }


    function AufgabeSpeichern()
    {
        (async () =>
        {           
            var Titel = e("NeueAufgabe_Titel").value
            var Details = e("NeueAufgabe_Details").value
            var Wichtigkeit = e("NeueAufgabe_Wichtigkeit").value
            var id = new Date().getTime()

            if(Titel == "" || Details == "")
            {
                alert("Fehlerhafte Eingaben")
            }
            else
            {  
                await SetVariable(`Aufgaben/${id}/Titel`, Titel)
                await SetVariable(`Aufgaben/${id}/Details`, Details)
                await SetVariable(`Aufgaben/${id}/Wichtigkeit`, Wichtigkeit)
                await SetVariable(`Aufgaben/${id}/ErledigtAm`, "")

                AufgabenSeiteInit()
            }
        })()
    }

    function AufgabeAlsErledigtMarkieren(id)
    {
        (async () =>
        {                 
            await SetVariable(`Aufgaben/${id}/ErledigtAm`, new Date().getTime())

            AufgabenSeiteInit()
        })()
    }
</script>

<!-- Hochladen lokales WinForm Betriebstagebuch -->
<!-- <script>
    var LokalesBetriebstagebuch = ""

    // Event-Listener für Änderungen im Dateiauswahldialog
    document.getElementById('fileInput').addEventListener('change', function(event) {
    // Dateiinformationen abrufen
    const file = event.target.files[0];

    if (file) {
    // FileReader erstellen
    const reader = new FileReader();

    // Event-Listener für das Laden der Datei
    reader.onload = function(e) {
        // Textinhalt aus der Datei abrufen
        const fileContent = e.target.result;

        // Textinhalt mit alert ausgeben
        LokalesBetriebstagebuch = fileContent;


        const eintraege = LokalesBetriebstagebuch.split("♥");

        console.log(eintraege.length);

        (async () =>
        {                 
            alert("Bist du dir sicher dass du das Betriebstagebuch erneut hochladen willst?")
            for (let i = 0; i < eintraege.length; i++)
            {

                var EindeutigeKennung = new Date().getTime();

                var Eintrag = eintraege[i];

                alert(`Eintrag: '${Eintrag}'`)

                console.log(`---------------   ${i} von ${eintraege.length}  ----------  ${Eintrag}`);

                var Vorinformationen = Eintrag.split("♀")[0];

                var Anmerkungen = Vorinformationen.split("|")[0];
                await SetVariable(`eintraege/${EindeutigeKennung}/Anmerkungen`, Anmerkungen)

                var GolM = JSON.parse(Vorinformationen.split("|")[1].toLowerCase())
                await SetVariable(`eintraege/${EindeutigeKennung}/GolM`, GolM)

                var KoeA = JSON.parse(Vorinformationen.split("|")[2].toLowerCase())
                await SetVariable(`eintraege/${EindeutigeKennung}/KoeA`, KoeA)

                var KoeM = JSON.parse(Vorinformationen.split("|")[3].toLowerCase())
                await SetVariable(`eintraege/${EindeutigeKennung}/KoeM`, KoeM)

                var UntM = JSON.parse(Vorinformationen.split("|")[4].toLowerCase())
                await SetVariable(`eintraege/${EindeutigeKennung}/UntM`, UntM)

                var datum = Vorinformationen.split("|")[5]
                await SetVariable(`eintraege/${EindeutigeKennung}/datum`, datum)

                var herkunft = Vorinformationen.split("|")[6]
                await SetVariable(`eintraege/${EindeutigeKennung}/herkunft`, herkunft)

                var artikelliste = Eintrag.split("♀")[1];

                if(artikelliste != "")
                {
                    var ArtikelStrings = artikelliste.split("♫");
                    for (let i = 0; i < ArtikelStrings.length; i++)
                    {
                        var beschreibung = ArtikelStrings[i].split("↕")[0];
                        await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i + 1}/beschreibung`, beschreibung)

                        var inventarnummer = ArtikelStrings[i].split("↕")[1];
                        await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i + 1}/inventarnummer`, inventarnummer)

                        var name = ArtikelStrings[i].split("↕")[2];
                        await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i + 1}/name`, name)

                        var zustand = ArtikelStrings[i].split("↕")[3];
                        await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i + 1}/zustand`, zustand)
                    }

                }

            }
        })()
    };

    // Die Datei als Text lesen
    reader.readAsText(file);
  }
});
</script> -->

<!-- Artikel Bearbeiten -->
<script>
    var ArtikelPfad_ArtikelBearbeiten_Variable = "";
    var ArtikelBearbeiten_UeberschreibenButtons_Enabled = false;

    var ArtikelBearbeitenUeberschrift = document.getElementById("ArtikelBearbeitenUeberschrift");

    var ArtikelPfadInfo_ArtikelBearbeiten = document.getElementById("ArtikelPfadInfo_ArtikelBearbeiten");

    var AktuellerArtikelName_BearbeitenSeite = document.getElementById("AktuellerArtikelName_BearbeitenSeite");
    var NeuerArtikelName_BearbeitenSeite = document.getElementById("NeuerArtikelName_BearbeitenSeite");

    var AktuelleInventarnummer_BearbeitenSeite = document.getElementById("AktuelleInventarnummer_BearbeitenSeite");
    var NeueInventarnummer_BearbeitenSeite = document.getElementById("NeueInventarnummer_BearbeitenSeite");

    var AktuelleBeschreibung_BearbeitenSeite = document.getElementById("AktuelleBeschreibung_BearbeitenSeite");
    var NeueBeschreibung_BearbeitenSeite = document.getElementById("NeueBeschreibung_BearbeitenSeite");

    var AktuellerZustand_BearbeitenSeite = document.getElementById("AktuellerZustand_BearbeitenSeite");
    var NeuerZustand_BearbeitenSeite = document.getElementById("NeuerZustand_BearbeitenSeite");

    var AlleEintrage_Zeiterfassung_unveriviziert = []
    var AlleEintrage_Zeiterfassung = []
    
    var AlleMitarbeiter = []

    function Event_Zeiterfassung_Load()
    {
        document.getElementById("Ladezeichen_Zeiterfassung").style.display = "block";
        document.getElementById("Bedienoberflaeche_Zeiterfassung").style.display = "none";

        Tabelle_Zeiterfassung.innerHTML = "";
        AlleEintrage_Zeiterfassung_unveriviziert = [];   
        AlleMitarbeiter = [];

        (async () =>
        {           
            var AlleMitarbeiterEintraege = await GetSubvariablen("Mitarbeiter");

            for(Mitarbeiter of AlleMitarbeiterEintraege)
            {
                var MitarbeiterEintrag = []

                var RFID_ID = getFileName(Mitarbeiter)
                var Name = await GetVariable(`${Mitarbeiter}`)
                
                MitarbeiterEintrag.RFID_ID = RFID_ID;
                MitarbeiterEintrag.Name = Name;
                MitarbeiterEintrag.IstAnwesend = false;
                MitarbeiterEintrag.Gsamtarbeitszeit = 0;
                MitarbeiterEintrag.AnwesendSeit = 0;

                AlleMitarbeiter.push(MitarbeiterEintrag)    
            }

            var AlleEintraege = await GetSubvariablen("Stempeluhr");

            AlleEintraege.forEach((Eintrag, n) =>
            {                               
                (async () =>
                {
                    var AlleUntereintraege = await GetSubvariablen(`${Eintrag}`);

                    AlleUntereintraege.forEach((Untereintrag, n) =>
                    {
                        (async () =>
                        {                                 
                            var inhalt = await GetVariable(`${Untereintrag}`)
                            
                            var Eintrag = []

                            var Type = getFileName(Untereintrag);
                            var UnixZeitstempel = inhalt.split("_")[0]
                            var RFID_ID = inhalt.split("_")[1]
                            
                            Eintrag.Type = Type;
                            Eintrag.UnixZeitstempel = UnixZeitstempel;
                            Eintrag.RFID_ID = RFID_ID;
                            Eintrag.Name = GetMitarbeiterNameByRFID_ID(RFID_ID);

                            AlleEintrage_Zeiterfassung_unveriviziert.push(Eintrag)

                            AlleEintrage_Zeiterfassung_Verifizieren()
                        })()                         
                    })
                })()                  
            })
        })()
    }

    function GetDatumString(DatumObjekt)
    {
        const tag = DatumObjekt.getDate().toString().padStart(2, '0');
        const monat = (DatumObjekt.getMonth() + 1).toString().padStart(2, '0');
        const jahr = DatumObjekt.getFullYear();


        return formatiertesDatum = `${tag}.${monat}.${jahr}`;
    }

    function GetTimeString(DatumObjekt)
    {
        const stunden = DatumObjekt.getHours().toString().padStart(2, '0');
        const minuten = DatumObjekt.getMinutes().toString().padStart(2, '0');

        return `${stunden}:${minuten}`;
    }

    function GetTimeStringSeconds(DatumObjekt)
    {
        const stunden = DatumObjekt.getHours().toString().padStart(2, '0');
        const minuten = DatumObjekt.getMinutes().toString().padStart(2, '0');
        const sekunden = DatumObjekt.getSeconds().toString().padStart(2, '0');

        return `${stunden}:${minuten}:${sekunden}`;
    }

    function zeitDifferenz(datum1, datum2)
    {
        // Zeitdifferenz in Millisekunden berechnen
        const differenzInMillisekunden = Math.abs(datum1 - datum2);

        // Zeitdifferenz in Stunden und Minuten umrechnen
        const stunden = Math.floor(differenzInMillisekunden / (1000 * 60 * 60));
        const minuten = Math.floor((differenzInMillisekunden % (1000 * 60 * 60)) / (1000 * 60));

        // Zeitdifferenz im Format "1h 23min" zurückgeben
        return `${stunden}h ${minuten}min`;
    }

    
    function ZeitInHundMin(differenzInMillisekunden)
    {

        // Zeitdifferenz in Stunden und Minuten umrechnen
        const stunden = Math.floor(differenzInMillisekunden / (1000 * 60 * 60));
        const minuten = Math.floor((differenzInMillisekunden % (1000 * 60 * 60)) / (1000 * 60));

        // Zeitdifferenz im Format "1h 23min" zurückgeben
        return `${stunden}h ${minuten}min`;
    }


    var Tabelle_Zeiterfassung = document.getElementById("Tabelle_Zeiterfassung")
    var Tabelle_Zeiterfassung_Uebersicht = document.getElementById("Tabelle_Zeiterfassung_Uebersicht")

    function AlleEintrage_Zeiterfassung_Verifizieren()
    {
        Tabelle_Zeiterfassung.innerHTML = "";
        Tabelle_Zeiterfassung_Uebersicht.innerHTML = "";

        for(Mitarbeiter of AlleMitarbeiter)
        {            
            var IstAnwesend = false;
            var ZeitVonBis = "";
            var Startzeit;
            var Dauer;
            var Gsamtarbeitszeit = 0;

            for(Eintrag of AlleEintrage_Zeiterfassung_unveriviziert)
            {   
                var DiesIstEinGueltigerEintrag = false;             

                if(Eintrag.Name == Mitarbeiter.Name)
                {
                    var DatumObjekt = new Date(parseInt(`${Eintrag.UnixZeitstempel}000`))
                    //DatumObjekt.setTime(DatumObjekt.getTime() + (2 * 60 * 60 * 1000));
                    var DatumString = GetDatumString(DatumObjekt)

                    if(Eintrag.Type == "Kommt" && !IstAnwesend)
                    {
                        DiesIstEinGueltigerEintrag = true;
                        IstAnwesend = true;
                        Mitarbeiter.IstAnwesend = true;
                        ZeitVonBis += `${GetTimeString(DatumObjekt)} - `
                        Startzeit = DatumObjekt;
                        Mitarbeiter.AnwesendSeit = Startzeit;
                    }
                    else if(Eintrag.Type == "Geht" && IstAnwesend)
                    {
                        DiesIstEinGueltigerEintrag = true;
                        IstAnwesend = false;
                        Mitarbeiter.IstAnwesend = false;
                        ZeitVonBis += `${GetTimeString(DatumObjekt)}`
                        Dauer = `${zeitDifferenz(Startzeit, DatumObjekt)}`
                        Gsamtarbeitszeit += Math.abs(DatumObjekt.getTime() - Startzeit.getTime());                        
                    }

                    if(DiesIstEinGueltigerEintrag && Eintrag.Type == "Geht")
                    {
                        Tabelle_Zeiterfassung.innerHTML += `
                        <tr>
                            <th scope="row">${Mitarbeiter.Name}</th>
                            <td>${DatumString}</td>
                            <td>${ZeitVonBis}</td>
                            <td>${Dauer}</td>
                        </tr> `   


                        ZeitVonBis = "";
                    }
                }
            }  

            Mitarbeiter.Gsamtarbeitszeit = Gsamtarbeitszeit; 
        }

        for(Mitarbeiter of AlleMitarbeiter)
        {
            Tabelle_Zeiterfassung_Uebersicht.innerHTML += `
            <tr>
                <th scope="row">${Mitarbeiter.Name}</th>
                <td style="color: mediumseagreen;">${Mitarbeiter.IstAnwesend ? `<strong>JA<br></strong>Bereits ${zeitDifferenz(Mitarbeiter.AnwesendSeit, new Date().getTime())}` : `<strong style="color: rgb(196, 0, 0);">NEIN</strong>`}</td>
                <td>${ZeitInHundMin(Mitarbeiter.Gsamtarbeitszeit)}</td>
            </tr> `
        }

        document.getElementById("Ladezeichen_Zeiterfassung").style.display = "none";
        document.getElementById("Bedienoberflaeche_Zeiterfassung").style.display = "block";
    }

    function Event_ArtikelBearbeiten_Load(ArtikelPfad)
    {
        ArtikelPfad_ArtikelBearbeiten_Variable = ArtikelPfad;

        ArtikelBearbeitenSeiteAktualisieren();
    }

    function ArtikelBearbeitenSeiteAktualisieren()
    {
        if(ArtikelPfad_ArtikelBearbeiten_Variable != "")
        {
            (async () =>
            {           
                ArtikelBearbeiten_UeberschreibenButtons_Enabled = false;

                ArtikelPfadInfo_ArtikelBearbeiten.innerHTML = ArtikelPfad_ArtikelBearbeiten_Variable;

                AktuellerArtikelName_BearbeitenSeite.innerHTML = "Wird geladen ...";
                ArtikelBearbeitenUeberschrift.innerHTML = `Artikel bearbeiten`
                AktuelleInventarnummer_BearbeitenSeite.innerHTML = "Wird geladen ...";
                AktuelleBeschreibung_BearbeitenSeite.innerHTML = "Wird geladen ..."; NeueBeschreibung_BearbeitenSeite.value = "";
                AktuellerZustand_BearbeitenSeite.innerHTML = "Wird geladen ...";

                if(ArtikelPfad_ArtikelBearbeiten_Variable != "")
                {
                    var name = await GetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/name`)
                    var inventarnummer = await GetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/inventarnummer`)
                    var beschreibung = await GetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/beschreibung`)
                    var zustand = await GetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/zustand`)

                    AktuellerArtikelName_BearbeitenSeite.innerHTML = name;
                    ArtikelBearbeitenUeberschrift.innerHTML = `Artikel bearbeiten:<br><br>${name}<br>`
                    AktuelleInventarnummer_BearbeitenSeite.innerHTML = inventarnummer;
                    AktuelleBeschreibung_BearbeitenSeite.innerHTML = beschreibung; NeueBeschreibung_BearbeitenSeite.value = beschreibung;
                    AktuellerZustand_BearbeitenSeite.innerHTML = zustand;

                    ArtikelBearbeiten_UeberschreibenButtons_Enabled = true;
                }            
            })()
        }        
    }

    function ArtikelBearbeiten_NameUeberschreibung_ButtonClicked()
    {
        if(ArtikelPfad_ArtikelBearbeiten_Variable != "" && ArtikelBearbeiten_UeberschreibenButtons_Enabled && NeuerArtikelName_BearbeitenSeite.value != "")
        {
            (async () =>
            {                 
                await SetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/name`, NeuerArtikelName_BearbeitenSeite.value);
                ArtikelBearbeitenSeiteAktualisieren();
            })()
        }
        else
        {
            alert("Fehler beim Überschreiben. Format überprüfen!");
        }
    }

    function ArtikelBearbeiten_InventarnummerUeberschreibung_ButtonClicked()
    {
        if(ArtikelPfad_ArtikelBearbeiten_Variable != "" && ArtikelBearbeiten_UeberschreibenButtons_Enabled)
        {
            (async () =>
            {                 
                await SetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/inventarnummer`, NeueInventarnummer_BearbeitenSeite.value);
                ArtikelBearbeitenSeiteAktualisieren();
            })()
        }
        else
        {
            alert("Fehler beim Überschreiben. Format überprüfen!");
        }
    }

    function ArtikelBearbeiten_BeschreibungUeberschreibung_ButtonClicked()
    {
        if(ArtikelPfad_ArtikelBearbeiten_Variable != "" && ArtikelBearbeiten_UeberschreibenButtons_Enabled)
        {
            (async () =>
            {                 
                await SetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/beschreibung`, NeueBeschreibung_BearbeitenSeite.value);
                ArtikelBearbeitenSeiteAktualisieren();
            })()
        }
        else
        {
            alert("Fehler beim Überschreiben. Format überprüfen!");
        }
    }

    function ArtikelBearbeiten_ZustandUeberschreibung_ButtonClicked()
    {
        if(ArtikelPfad_ArtikelBearbeiten_Variable != "" && ArtikelBearbeiten_UeberschreibenButtons_Enabled)
        {
            (async () =>
            {                 
                await SetVariable(`${ArtikelPfad_ArtikelBearbeiten_Variable}/zustand`, NeuerZustand_BearbeitenSeite.value);
                ArtikelBearbeitenSeiteAktualisieren();
            })()
        }
        else
        {
            alert("Fehler beim Überschreiben. Format überprüfen!");
        }
    }
</script>

<!-- Seiten Switcher -->
<script>
    var Seite_EintragHinzufuegen = document.getElementById("Seite_EintragHinzufuegen");
    var Seite_AuflistungEinsaetze = document.getElementById("Seite_AuflistungEinsaetze");
    var Seite_Inventarsucher = document.getElementById("Seite_Inventarsucher");
    var Seite_ArtikelBearbeiten = document.getElementById("Seite_ArtikelBearbeiten");
    var Seite_Zeiterfassung = document.getElementById("Seite_Zeiterfassung");
    var Seite_CodeGenerator = document.getElementById("Seite_CodeGenerator");
    var Seite_Aufgaben = e("Seite_Aufgaben");
    var Seite_Zugzeit = e("Seite_Zugzeit")
    var Seite_FahrzeugGesamt = e("Seite_FahrzeugGesamt")

    function Event_AnmeldungAbgeschlossen()
    {
                           
    }

    function GetMitarbeiterNameByRFID_ID(RFID_ID)
    {
        for(Mitarbeiter of AlleMitarbeiter)
        {
            if(Mitarbeiter.RFID_ID == RFID_ID)
            {
                return Mitarbeiter.Name;
            }
        }
    }

    function Hauptmenue_Seite_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "block";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";
        }
        
    }

    function EintragHinzufuegen_Seite_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "block";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";
        }     
    }

    function Inventarsucher_Seite_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            GesamteBeuteAuflistungInventarSucher = [];
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "block";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";

            InventarsucherInit();
        }
    }

    function ZeiterfassungSeiteButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "block";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";

            Event_Zeiterfassung_Load();
        }
    }

    function ArtikelBearbeiten_Seite_Oeffnen(ArtikelPfad)
    {
        if(IstAngemeldet && ArtikelPfad != "" && ArtikelPfad != undefined)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "block";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";

            Event_ArtikelBearbeiten_Load(ArtikelPfad);
        }
    }

    function CodeGenerator_Seite_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "block";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";

            Event_CodeGenerator_Load();
        }
    }

    function Statistik_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "block";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";

            Event_Statistik_Load();
        }
    }

    function Aufgaben_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "block";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "none";

            AufgabenSeiteInit();
        }
    }

    function Zugzeit_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "block";
            Seite_FahrzeugGesamt.style.display = "none";

            ZugzeitSeiteInit();
        }
    }

    function Fahrzeug_ButtonClicked()
    {
        if(IstAngemeldet)
        {
            Seite_EintragHinzufuegen.style.display = "none";
            Seite_AuflistungEinsaetze.style.display = "none";
            Seite_Inventarsucher.style.display = "none";
            Seite_ArtikelBearbeiten.style.display = "none";
            Seite_Zeiterfassung.style.display = "none";
            Seite_CodeGenerator.style.display = "none";
            Seite_Statistik.style.display = "none";
            Seite_Aufgaben.style.display = "none";
            Seite_Zugzeit.style.display = "none";
            Seite_FahrzeugGesamt.style.display = "block";

            FahrzeugSeiteInit();
        }
    }

    if(cookieExists("PasswortBetriebstagebuch"))
    {
        InitBetriebstagebuch(getCookie("PasswortBetriebstagebuch"))
    }
    else
    {
        document.getElementById("AnmeldungFenster").style.display = "block"
    }
</script>

<!-- Inventarsucher -->
<script>
    var GesamteBeuteAuflistungInventarSucher = [];

    var Ladezeichen_Inventarsucher = document.getElementById("Ladezeichen_Inventarsucher");
    var Bedienoberflaeche_Inventarsucher = document.getElementById("Bedienoberflaeche_Inventarsucher");
    var RadioButtonSucheNachInventarnummer = document.getElementById("RadioButtonSucheNachInventarnummer");
    var RadioButtonSucheNachArtikel = document.getElementById("RadioButtonSucheNachArtikel")
    var Suchtext_Inventarsucher_TextBox = document.getElementById("Suchtext_Inventarsucher_TextBox");
    var Suchergebnisse_Ueberschrift_Inventarsucher = document.getElementById("Suchergebnisse_Ueberschrift_Inventarsucher");
    var Suchergebnisse_Inventarsucher = document.getElementById("Suchergebnisse_Inventarsucher");

    function InventarsucherInit()
    {
        if(IstAngemeldet)
        {
            (async () =>
            {                         
                var AnzahlBeuteBereitsGefunden = 0;
                var AnzahlBeuteGesamt = 0;

                Inventarsucher_SucheZuruecksetzen();        
                Ladezeichen_Inventarsucher.style.display = "block";
                Bedienoberflaeche_Inventarsucher.style.display = "none";

                (async () =>
                {                 
                    var AlleEinsaetze = await GetSubvariablen("eintraege");
                    
                    AlleEinsaetze.forEach((EinsatzPfad, n) =>
                    {                              
                        (async () =>
                        {                      
                            var AlleArtikel = await GetSubvariablen(`${EinsatzPfad}/artikelListe`);
                            AnzahlBeuteGesamt += AlleArtikel.length;

                            var datum = await GetVariable(`${EinsatzPfad}/datum`)
                            var herkunft = await GetVariable(`${EinsatzPfad}/herkunft`)

                            AlleArtikel.forEach((ArtikelPfad, n) =>
                            {                  
                                (async () =>
                                {                 
                                    var beschreibung = await GetVariable(`${ArtikelPfad}/beschreibung`)
                                    var inventarnummer = await GetVariable(`${ArtikelPfad}/inventarnummer`)
                                    var name = await GetVariable(`${ArtikelPfad}/name`)
                                    var zustand = await GetVariable(`${ArtikelPfad}/zustand`)

                                    var BeuteBeschreibung =
                                    {
                                        beschreibung: beschreibung,
                                        inventarnummer: inventarnummer,
                                        herkunft: herkunft,
                                        name: name,
                                        zustand: zustand,
                                        ArtikelPfad: ArtikelPfad,
                                        datum: datum,
                                    }

                                    GesamteBeuteAuflistungInventarSucher.push(BeuteBeschreibung);
                                    
                                    AnzahlBeuteBereitsGefunden ++;

                                    if(AnzahlBeuteBereitsGefunden == AnzahlBeuteGesamt)
                                    {
                                        SucheInitAbgeschlossenIntern();
                                    }
                                })()
                            })
                        })()                   
                    })                    
                })()     

                function SucheInitAbgeschlossenIntern()
                {

                    Ladezeichen_Inventarsucher.style.display = "none";
                    Bedienoberflaeche_Inventarsucher.style.display = "block";
                    Event_Inventarsucher_InitAbgeschlossen();
                }
            })()            
        }
    }

    function Inventarsucher_SucheZuruecksetzen()
    {
        Suchergebnisse_Inventarsucher.innerHTML = '';
        Suchtext_Inventarsucher_TextBox.value = '';
        Suchergebnisse_Ueberschrift_Inventarsucher.innerHTML = 'Suchergebnisse: (0)';
        Suchergebnisse_Inventarsucher.innerHTML = 'Bitte Suchtext eingeben ...';        

        if(RadioButtonSucheNachInventarnummer.checked)
        {
            document.getElementById("QRSCAN_Button_Suche").disabled = false
        }
        else
        {
            document.getElementById("QRSCAN_Button_Suche").disabled = true
        }
    }

    function Event_Inventarsucher_InitAbgeschlossen()
    {
        RadioButtonSucheNachInventarnummer.checked = true;
        RadioButtonSucheNachArtikel.checked = false;
    }

    function Suchtext_Inventarsucher_TextChanged()
    {        
        var SucheNachInventarnummer = RadioButtonSucheNachInventarnummer.checked;
        Suchergebnisse_Inventarsucher.innerHTML = "Suchergebnisse werden geladen ...";

        var Suchtext = Suchtext_Inventarsucher_TextBox.value.toLowerCase().replace("ä", "ae").replace("ö", "oe").replace("ü", "ue");
        var AnzahlSuchergebnisse = 0;

        if(Suchtext != "")
        {
            GesamteBeuteAuflistungInventarSucher.forEach((Beute, n) =>
            {
                if(SucheNachInventarnummer)
                {
                    if(Beute.inventarnummer != "")
                    {
                     

                        if(Beute.inventarnummer.toString().toLowerCase().replace("ä", "ae").replace("ö", "oe").replace("ü", "ue").includes(Suchtext))
                        {
                            AnzahlSuchergebnisse += 1;
                            AddBeuteZurAuflistung_InventarSucher(Beute);
                        }
                    }
                }
                else
                {
                    if(Beute.name != "")
                    {
                        if(Beute.name.toString().toLowerCase().includes(Suchtext) ||
                        Beute.beschreibung.toString().toLowerCase().replace("ä", "ae").replace("ö", "oe").replace("ü", "ue").includes(Suchtext) ||
                        Beute.datum.toString().toLowerCase().replace("ä", "ae").replace("ö", "oe").replace("ü", "ue").includes(Suchtext))
                        {
                            AnzahlSuchergebnisse += 1;
                            AddBeuteZurAuflistung_InventarSucher(Beute);
                        }
                    }
                }
            })
        }
        else
        {
            Suchergebnisse_Inventarsucher.innerHTML = "Bitte Suchtext eingeben ...";
        }     


        if(Suchergebnisse_Inventarsucher.innerHTML == "Suchergebnisse werden geladen ...")   
        {
            Suchergebnisse_Inventarsucher.innerHTML = '<img src="https://i.imgur.com/EELyqbg.png" width="50px" alt=""><strong class="ml-2">Keine Suchergebnisse gefunden</strong>';
        }

        Suchergebnisse_Ueberschrift_Inventarsucher.innerHTML = `Suchergebnisse: (${AnzahlSuchergebnisse})`;
        
    }

    function AddBeuteZurAuflistung_InventarSucher(BeuteObjekt)
    {
        if(Suchergebnisse_Inventarsucher.innerHTML == "Suchergebnisse werden geladen ...")   
        {
            Suchergebnisse_Inventarsucher.innerHTML = "";
        }

        Suchergebnisse_Inventarsucher.innerHTML += `
        <div style="background-color: rgb(70, 70, 70); border-radius: 10px; padding: 15px;">
            <strong style="font-size: x-large; color: white;"><img src="https://i.imgur.com/jvYVQhc.png" class="mr-2" height="26px" alt="">${BeuteObjekt.name}</strong><br><br>     
            <strong>Herkunft</strong>: ${BeuteObjekt.herkunft == "" ? "Herkunft unbekannt" : `HGEG-${BeuteObjekt.herkunft.toUpperCase()}`}<br>
            <strong>Datum</strong>: ${BeuteObjekt.datum}<br>
            <strong>Inventarnummer</strong>: ${BeuteObjekt.inventarnummer == "" ? "Keine Inventarnummer" : BeuteObjekt.inventarnummer}<br><br>
            <strong>Beschreibung</strong>:<br>${BeuteObjekt.beschreibung == "" ? "Keine Beschreibung" : BeuteObjekt.beschreibung}<br>
            <br>
            <strong>Zustand</strong>: ${BeuteObjekt.zustand}<br><br>
            <button type="button" onclick="ArtikelBearbeiten_Seite_Oeffnen('${BeuteObjekt.ArtikelPfad}')" class="btn btn-primary">Bearbeiten</button>
        </div>
        <br> `
    }
</script>

<!-- Eintrag hinzufuegen -->
<script>
    function EintragSpeichern_BeuteHinzufuegenSeite_ButtonClicked()
    {
        (async () =>
        {                 
            var EindeutigeKennung = new Date().getTime();
            
            var Anmerkungen = document.getElementById("AnmerkungenTextBox").value;
            var GolM = document.getElementById("MarianAnwesendCheckBox").checked;
            var KoeA = document.getElementById("AndreasAnwesendCheckBox").checked;
            var KoeM = document.getElementById("KoeckMarkusAnwesendCheckBox").checked;
            var UntM = document.getElementById("MarkusAnwesendCheckBox").checked;

            var datum = formatDate(new Date(document.getElementById("AusgewaehltesDatumEintragHinzufuegen").value));
            var herkunft = document.getElementById("herkunftCombobox").value;

            var AuflistungBeute_EintragHinzufuegen = document.getElementById('AuflistungBeute_EintragHinzufuegen');
            var elemente = AuflistungBeute_EintragHinzufuegen.children;

            if(!(!GolM && !KoeA && !KoeM && !UntM))
            {
                if(!herkunft.includes("Bitte"))
                {
                    var AllePromises = [];    

                    AllePromises.push(
                    (async () =>
                    {                 
                        await SetVariable(`eintraege/${EindeutigeKennung}/Anmerkungen`, Anmerkungen);
                        await SetVariable(`eintraege/${EindeutigeKennung}/datum`, datum);
                        await SetVariable(`eintraege/${EindeutigeKennung}/herkunft`, herkunft);

                        await SetVariable(`eintraege/${EindeutigeKennung}/GolM`, GolM);
                        await SetVariable(`eintraege/${EindeutigeKennung}/KoeA`, KoeA);
                        await SetVariable(`eintraege/${EindeutigeKennung}/KoeM`, KoeM);
                        await SetVariable(`eintraege/${EindeutigeKennung}/UntM`, UntM);                        
                    })())

                    if(!AuflistungBeute_EintragHinzufuegen.innerHTML.includes("Noch keine Beute"))
                    {
                        Array.from(elemente).forEach(element =>
                        {      
                            console.log(element);
                            var id = element.id;
                            var name = document.getElementById(id).getAttribute("name");
                            var i = document.getElementById(id).getAttribute("i");
                            var inventarnummer = document.getElementById(`inventarnummer_${id}`).value;
                            var beschreibung = document.getElementById(`beschreibung_${id}`).value;
                            var zustand = document.getElementById(`zustand_${id}`).value;
                            
                            AllePromises.push(
                            (async () =>
                            {                 
                                await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i}/beschreibung`, beschreibung);
                                await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i}/inventarnummer`, inventarnummer);
                                await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i}/name`, name);
                                await SetVariable(`eintraege/${EindeutigeKennung}/artikelListe/${i}/zustand`, zustand);
                            })())                                                                  
                        });
                    }
                    
                    await Promise.all(AllePromises);

                    location.reload();
                }
                else
                {
                    alert("Keine Organisation ausgewählt!")
                }            
            }
            else
            {
                alert("Mindestens 1 Person muss teilnehmen!");
            }        
        })()        
    }

    var EintragHinzufuegen_Aktuelles_i = 1;

    function BeuteHinzufuegenButtonClicked()
    {
        if(IstAngemeldet)
        {
            
            var AuflistungBeute_EintragHinzufuegen = document.getElementById("AuflistungBeute_EintragHinzufuegen");
            var Anzahl = document.getElementById("AnzahlArtikelBeuteHinzufuegenTextBox").value;      
            var name = document.getElementById("BezeichnungArtikelBeuteHinzufuegenTextBox").value;
            
            document.getElementById("AnzahlArtikelBeuteHinzufuegenTextBox").value = "1";
            document.getElementById("BezeichnungArtikelBeuteHinzufuegenTextBox").value = "";

            if(Anzahl != "" && Anzahl != "0" && Anzahl != 0 && name != "" && !Anzahl.includes(";") && !name.includes(";"))
            {
                if(AuflistungBeute_EintragHinzufuegen.innerHTML.includes("Noch keine Beute")) { AuflistungBeute_EintragHinzufuegen.innerHTML = "" }

                for (var i = 1; i <= Anzahl; i++)
                {
                    var id = `${name}_${EintragHinzufuegen_Aktuelles_i}_BeuteHinzufuegenAuflistung`


                    //AuflistungBeute_EintragHinzufuegen.insertAdjacentHTML('beforeend', `<div name="${name}" i="${EintragHinzufuegen_Aktuelles_i}" id="${id}"><strong>${name}</strong> - Beschreibung: <input type="text" id="beschreibung_${id}"> Zustand: ${selectTagZustand} InvNr: <input type="text" id="inventarnummer_${id}"> <button id="Entfernen" onclick="document.getElementById('inventarnummer_${id}').value = '00000000'">0</button><button id="Entfernen" onclick="document.getElementById('${id}').remove()">Entfernen</button><br><br></div>`)

                    AuflistungBeute_EintragHinzufuegen.insertAdjacentHTML('beforeend', 
                    `
                    <div style="border: 1px solid #ccc; border-radius: 5px; padding: 10px;" name="${name}" i="${EintragHinzufuegen_Aktuelles_i}" id="${id}">
                        <strong style="font-size: x-large;"> ${name}</strong><br><br>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon3" style="width: 120px;">Beschreibung</span>
                            </div>
                            <input type="text" class="form-control" id="beschreibung_${id}" aria-describedby="basic-addon3">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon3" style="width: 120px;">InventarNr</span>
                            </div>
                            <input type="number" class="form-control" id="inventarnummer_${id}" aria-describedby="basic-addon3">                      
                        </div>
                        
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01" style="width: 120px;">Zustand</label>
                            </div>
                            <select class="custom-select" id="zustand_${id}">
                                <option value="Unbekannt">Unbekannt</option>
                                <option value="Funktioniert">Funktioniert</option>
                                <option value="FunktioniertTeilweise">FunktioniertTeilweise</option>                                    
                                <option value="Defekt">Defekt</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-danger" style="width: 118px;" id="Entfernen" onclick="document.getElementById('${id}').remove()"><img src="https://i.imgur.com/Rj1vuiK.png" class="mr-2" height="22px" alt="">Löschen</button> 
                        <button class="btn btn-light" onclick="document.getElementById('inventarnummer_${id}').value = '00000000'"><img src="https://i.imgur.com/F0aGYuh.png" class="mr-2" height="22px" alt="">0</button> 
                        <button class="btn btn-light" onclick="ReadQRCode('inventarnummer_${id}', false)"><img src="https://i.imgur.com/TONSd5l.png" class="mr-2" height="22px" alt="">InvNr-Scan</button><br>
                    </div> `
                    
                    )


                    EintragHinzufuegen_Aktuelles_i++;
                }

            }
            else
            {
                alert("Fehlerhafte Eingaben!");
            }
        }
    }
</script>

<!-- Einsaetze auflisten -->
<script>
    var currentDate = new Date();
    var currentDateFormatted = formatDate(currentDate)
    
    document.getElementById('AusgewaehltesDatum').value = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
    document.getElementById('AusgewaehltesDatumEintragHinzufuegen').value = document.getElementById('AusgewaehltesDatum').value;
    var FlowLayoutPanel_Einsatzauflistung = document.getElementById("FlowLayoutPanel_Einsatzauflistung")



    function ButtonEinsaetzeAnzeigenClicked()
    {
        if(IstAngemeldet)
        {
            TagAuflistungAktualisieren();
        }
    }

    function ClearFlowLayoutPanel_Einsatzauflistung()
    {
        FlowLayoutPanel_Einsatzauflistung.innerHTML = "";
    }

    

    function TagAuflistungAktualisieren()
    {
        if(IstAngemeldet)
        {
            var NeueDIVs = [];

            var AusgewaehltesDatumInhalt = formatDate(new Date(document.getElementById('AusgewaehltesDatum').value));

            FlowLayoutPanel_Einsatzauflistung.innerHTML = '<div class="spinner-border text-secondary" role="status" style="text-align: center;"></div><br><br>Einsätze werden geladen ...';
            
            (async () =>
            {                 
                var AlleEinsaetze = await GetSubvariablen("eintraege");
                
                var promiseArray0 = [];

                AlleEinsaetze.forEach((EinsatzPfad, n) =>
                {                                 
                    promiseArray0.push(   
                    (async () =>
                    {      
                        var DatumDesEinsatzes = await GetVariable(`${EinsatzPfad}/datum`);
                        
                        if(DatumDesEinsatzes == AusgewaehltesDatumInhalt)
                        {                            
                            var AnwesendePersonen = "";   
                            if(await GetVariable(`${EinsatzPfad}/UntM`)) {AnwesendePersonen += "Markus "}
                            if(await GetVariable(`${EinsatzPfad}/KoeA`)) {AnwesendePersonen += "Andreas "}
                            if(await GetVariable(`${EinsatzPfad}/KoeM`)) {AnwesendePersonen += "KoeckMarkus "}
                            if(await GetVariable(`${EinsatzPfad}/GolM`)) {AnwesendePersonen += "Marian "}

                            var Anmerkungen = await GetVariable(`${EinsatzPfad}/Anmerkungen`);
                            if(Anmerkungen == ""){Anmerkungen = "KEINE"}
                            
                            var BeuteString = "";

                            var AlleBeute = await GetSubvariablen(`${EinsatzPfad}/artikelListe`);

                            var promiseArray = [];
                            AlleBeute.forEach((BeutePfad, n) =>
                            {
                                promiseArray.push(
                                (async () =>
                                {          
                                    //var beschreibung = await GetVariable(`${BeutePfad}/beschreibung`)      
                                    var inventarnummer = await GetVariable(`${BeutePfad}/inventarnummer`) 
                                    var name = await GetVariable(`${BeutePfad}/name`)
                                    var zustand = await GetVariable(`${BeutePfad}/zustand`)                                    
                                    
                                    zustand = `(${zustand})`

                                    if(inventarnummer != "")
                                    {
                                        inventarnummer = `: <span style="color: rgb(255,255,255);"><strong>${inventarnummer}</strong></span>`;
                                    }

                                    if(zustand == "" || zustand == "(Unbekannt)")
                                    {
                                        zustand = "";
                                    }

                                    BeuteString += 
                                    `${name}${inventarnummer} ${zustand}<br>`
                                    
                                })())
                                
                            })

                            await Promise.all(promiseArray);
                            promiseArray = []

                            var Hintergrundfarbe = "rgb(44, 97, 68)";

                            if(BeuteString == "")
                            {
                                Hintergrundfarbe = "rgb(200, 97, 68)";
                                BeuteString = "Keine Beute";
                            }
              
                            NeueDIVs.push(
                                `<div style="background-color: ${Hintergrundfarbe}; border-radius: 10px; padding: 15px;">
                                <strong style="font-size: x-large;">HGEG-${await GetVariable(`${EinsatzPfad}/herkunft`)} am ${DatumDesEinsatzes}</strong><br>      
                                Anmerkungen: ${Anmerkungen}<br>
                                Anwesend: ${AnwesendePersonen}<br><br>
                
                                <strong>Beute:</strong><br>
                                ${BeuteString}
                                </div>
                                <br>`
                            );
                                                    
                        }
                    })())                                                        
                });

                await Promise.all(promiseArray0);
                promiseArray0 = []

                FlowLayoutPanel_Einsatzauflistung.innerHTML = "";

                for (var neuesDIV of NeueDIVs)
                {
                    FlowLayoutPanel_Einsatzauflistung.innerHTML += neuesDIV;
                }

                if(FlowLayoutPanel_Einsatzauflistung.innerHTML == "")
                {
                    FlowLayoutPanel_Einsatzauflistung.innerHTML = '<img src="https://i.imgur.com/EELyqbg.png" width="50px" alt=""><strong class="ml-2">Kein Einsatz an diesem Tag</strong>';
                }

            })()
        }        
    }

        
</script>

<script src="https://unpkg.com/html5-qrcode"></script>

<!-- QRSCAN -->
<script>
    var ScrollPositionVorQRSCAN = 0;
    var qrCodeScanner;

    function ReadQRCode(WohinSchreiben, SucheDanachStarten)
    {
        ScrollPositionVorQRSCAN = window.scrollY;

        document.getElementById("QRSCAN").style.display = "block"
        document.getElementById("GesamteWebseite").style.display = "none"

        qrCodeScanner = new Html5Qrcode('qr-code-reader');

        qrCodeScanner.start(
            {
                facingMode: 'environment'
            },

            {
                fps: 5,
                qrbox: 200
            },

            qrCodeMessage =>
            {
                var QRCodeString = qrCodeMessage;
                
                document.getElementById(WohinSchreiben).value = QRCodeString;

                if(SucheDanachStarten)
                {
                    Suchtext_Inventarsucher_TextChanged();
                }

                document.getElementById("QRSCAN").style.display = "none"
                document.getElementById("GesamteWebseite").style.display = "block"

                window.scrollTo(0, ScrollPositionVorQRSCAN);

                qrCodeScanner.stop();
            },

            errorMessage =>
            {
                //console.error(errorMessage);
            }
        );
    }

    function QRSCAN_Abbrechen()
    {
        qrCodeScanner.stop();

        document.getElementById("QRSCAN").style.display = "none"
        document.getElementById("GesamteWebseite").style.display = "block"
        window.scrollTo(0, ScrollPositionVorQRSCAN);
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/barcodes/JsBarcode.code128.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.debug.js"></script>

<!-- CodeGenerator -->
<script>
    var canvas = document.getElementById("CodeGeneratorCanvas");

    function Event_CodeGenerator_Load()
    {               
        var barcode_element = document.getElementById('barcode');
        var context = canvas.getContext('2d');
        canvas.width = 7 * 180 + 1;
        canvas.height = 16 * 104 + 1;

        context.fillStyle = 'black';
        context.fillRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < 7; i++)
        {
            var x = 1 + 180 * i;
            
            for (let j = 0; j < 16; j++)
            {
                var y = 1 + 104 * j;

                var NeueNummer = "";

                for (let n = 0; n < 8; n++)
                {
                    var randomNumber = Math.floor(Math.random() * 10);
                    NeueNummer += randomNumber;
                }
                
                DrawImage(NeueNummer, x, y);            
            }      
        }       

        barcode_element.style.display = 'none';
        canvas.style.display = 'none'


        function DrawImage(Nr, x, y)
        {
            JsBarcode("#barcode", Nr,
            {
                format: "CODE128",
                lineColor: "#00",
                width: 2,
                height: 60,
                displayValue: true
            });

            var svgURL = 'data:image/svg+xml,' + encodeURIComponent(new XMLSerializer().serializeToString(barcode_element));
            var img = new Image();
            img.onload = function()
            {
                context.drawImage(img, x, y);
            };
            img.src = svgURL;
        }     
    }

    function GetDateTimeFormal()
    {
        var d = new Date();

        return `${d.getFullYear()}${String(d.getMonth() + 1).padStart(2, '0')}${String(d.getDate()).padStart(2, '0')}_${String(d.getHours()).padStart(2, '0')}${String(d.getMinutes()).padStart(2, '0')}`
    }

    function Download_BarcodePDF()
    {
        var doc = new jsPDF();

        var imgData = canvas.toDataURL('image/png');
        doc.text(`HGEG INV.NR BARCODES (EXPORTIERT: ${GetDateTimeFormal()})`, 5, 12);
        doc.addImage(imgData, 'PNG', 5, 297 - 277 - 5, 200, 277 - 5);

        doc.save(`HGEG_InvNr_${GetDateTimeFormal()}.pdf`);
    }
</script>
